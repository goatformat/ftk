{"mappings":"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","sources":["html/trace/trace.ts"],"sourcesContent":["import {State, Random, ID, DeckID, DATA, OPTIONS, Ids} from '../../src';\nimport {createElement, track, renderState} from '../common';\n\nconst render = (s: State, rendered: HTMLElement, banished: DeckID[] = [], graveyard: ID[] = []) => {\n  rendered.appendChild(renderState(s, banished, graveyard));\n\n  const wrapper = createElement('div', 'wrapper');\n  const details = createElement('details');\n  const summary = createElement('summary');\n\n  let code = createElement('code');\n  let pre = createElement('pre');\n  pre.textContent = s.toString();\n  code.appendChild(pre);\n  summary.appendChild(code);\n  details.appendChild(summary);\n\n  code = createElement('code');\n  pre = createElement('pre');\n  pre.textContent = s.next().map(({key, score}) => `${key} = ${score.toFixed(2)}`).join('\\n');\n  code.appendChild(pre);\n  details.appendChild(code);\n  wrapper.appendChild(details);\n  rendered.appendChild(wrapper);\n\n  return rendered;\n};\n\nconst win = (path: string[], trace: string[]) => {\n  const banished: DeckID[] = [];\n  const graveyard: ID[] = [];\n\n  const root = createElement('div');\n\n  let div = createElement('div', 'trace');\n  let last = '';\n  let major = 0;\n  let ul = createElement('ul');\n  for (const line of trace) {\n    const minor = line.startsWith('  ');\n    if (!minor) {\n      if (major) {\n        div.appendChild(ul);\n        ul = createElement('ul');\n        root.appendChild(div);\n        div = createElement('div', 'trace');\n      }\n\n      if (path[major - 1]) {\n        const s = State.fromString(path[major - 1]);\n        const activated = last.startsWith('Activate')\n          ? DATA[/\"(.*?)\"/.exec(last)![1]].id\n          : (last.startsWith('Set') && !last.endsWith('face-down'))\n            ? DATA[/then activate(?: face-down)? \"(.*?)\"/.exec(last)![1]].id\n            : undefined;\n        track(s.banished, banished, activated);\n        track(s.graveyard, graveyard, activated);\n\n        const rendered = createElement('div', 'state');\n        root.appendChild(render(s, rendered, banished, graveyard));\n      }\n      last = line;\n      major++;\n\n      const span = createElement('span');\n      span.innerHTML = line.replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n      div.appendChild(span);\n    } else {\n      const li = createElement('li');\n      li.textContent = line;\n      ul.appendChild(li);\n    }\n  }\n  root.appendChild(div);\n\n  return root;\n};\n\nconst lose = (s: State) => {\n  const rendered = createElement('div', 'state');\n\n  const div = createElement('div', 'trace');\n  const span = createElement('span');\n  span.innerHTML = s.trace![0].replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n  div.appendChild(span);\n  rendered.appendChild(div);\n  return render(s, rendered);\n};\n\nconst state = (() => {\n  const arg = (window.location.hash || window.location.search).slice(1);\n  const seed = (n: string) => Random.seed(n && !isNaN(+n) ? +n : ~~(Math.random() * (2 ** 31 - 1)));\n  const fallback = OPTIONS.includes(arg[0] as ID)\n    ? State.create(arg[0] as ID, new Random(seed(arg.slice(1))), true)\n    : State.create(Ids.Sangan, new Random(seed(arg)), true);\n  if (arg) {\n    try {\n      const s = State.fromString(decodeURIComponent(arg), true);\n      if (!State.verify(s).length) return s;\n    } catch {\n      return fallback;\n    }\n  }\n  return fallback;\n})();\n\nconst result = state.search({cutoff: 1e7, prescient: false, width: 0.5});\n\nconst content = document.getElementById('content')!;\nwhile (content.firstChild) content.removeChild(content.firstChild);\n\nif (!('path' in result)) {\n  const div = createElement('div');\n  div.textContent = `Unsuccessfully searched ${result.visited} states.`;\n  content.appendChild(div);\n  content.appendChild(createElement('br'));\n  content.appendChild(lose(state));\n} else {\n  const div = createElement('div');\n  div.textContent = `Found a path of length ${result.path.length} after searching ${result.visited} states:`;\n  content.appendChild(div);\n  content.appendChild(createElement('br'));\n  content.appendChild(win(result.path, result.trace!));\n}\n"],"names":["$4728382ffb959750$var$render","s","rendered","banished","graveyard","appendChild","$iPHaw","renderState","wrapper","createElement","details","summary","code","pre","textContent","toString","next","map","key","score","toFixed","join","$4728382ffb959750$var$state","arg","window","location","hash","search","slice","seed","n","$l7khe","Random","isNaN","Math","random","fallback","OPTIONS","includes","State","create","Ids","Sangan","fromString","decodeURIComponent","verify","length","$4728382ffb959750$var$result","cutoff","prescient","width","$4728382ffb959750$var$content","document","getElementById","firstChild","removeChild","div","path","visited","trace","root","last","major","ul","line","startsWith","li","activated","DATA","exec","id","endsWith","undefined","track","span","innerHTML","replace","_","g","$4728382ffb959750$var$win","$4728382ffb959750$var$lose"],"version":3,"file":"index.f1b32669.js.map"}