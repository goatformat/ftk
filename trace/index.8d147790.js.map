{"mappings":"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","sources":["html/trace/trace.ts"],"sourcesContent":["import {State, Random, Option, ID, DeckID, DATA, OPTIONS} from '../../src';\nimport {createElement, track, renderState} from '../common';\n\nconst render = (s: State, rendered: HTMLElement, banished: DeckID[] = [], graveyard: ID[] = []) => {\n  rendered.appendChild(renderState(s, banished, graveyard));\n\n  const wrapper = createElement('div', 'wrapper');\n  const details = createElement('details');\n  const summary = createElement('summary');\n\n  let code = createElement('code');\n  let pre = createElement('pre');\n  pre.textContent = s.toString();\n  code.appendChild(pre);\n  summary.appendChild(code);\n  details.appendChild(summary);\n\n  code = createElement('code');\n  pre = createElement('pre');\n  pre.textContent = s.next().map(({key, score}) =>\n    `${State.decode(key).toString()} = ${score.toFixed(2)}`).join('\\n');\n  code.appendChild(pre);\n  details.appendChild(code);\n  wrapper.appendChild(details);\n  rendered.appendChild(wrapper);\n\n  return rendered;\n};\n\nconst win = (path: string[], trace: string[]) => {\n  const banished: DeckID[] = [];\n  const graveyard: ID[] = [];\n\n  const root = createElement('div');\n\n  let div = createElement('div', 'trace');\n  let last = '';\n  let major = 0;\n  let ul = createElement('ul');\n  for (const line of trace) {\n    const minor = line.startsWith('  ');\n    if (!minor) {\n      if (major) {\n        div.appendChild(ul);\n        ul = createElement('ul');\n        root.appendChild(div);\n        div = createElement('div', 'trace');\n      }\n\n      if (path[major - 1]) {\n        const s = State.decode(path[major - 1], true);\n        const activated = last.startsWith('Activate')\n          ? DATA[/\"(.*?)\"/.exec(last)![1]].id\n          : (last.startsWith('Set') && !last.endsWith('face-down'))\n            ? DATA[/then activate(?: face-down)? \"(.*?)\"/.exec(last)![1]].id\n            : undefined;\n        track(s.banished, banished, activated);\n        track(s.graveyard, graveyard, activated);\n\n        const rendered = createElement('div', 'state');\n        root.appendChild(render(s, rendered, banished, graveyard));\n      }\n      last = line;\n      major++;\n\n      const span = createElement('span');\n      span.innerHTML = line.replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n      div.appendChild(span);\n    } else {\n      const li = createElement('li');\n      li.textContent = line;\n      ul.appendChild(li);\n    }\n  }\n  root.appendChild(div);\n\n  return root;\n};\n\nconst lose = (s: State) => {\n  const rendered = createElement('div', 'state');\n\n  const div = createElement('div', 'trace');\n  const span = createElement('span');\n  span.innerHTML = s.trace![0].replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n  div.appendChild(span);\n  rendered.appendChild(div);\n  return render(s, rendered);\n};\n\nconst state = (() => {\n  const arg = (window.location.hash || window.location.search).slice(1);\n  const seed = (n: string) => Random.seed(n && !isNaN(+n) ? +n : ~~(Math.random() * (2 ** 31 - 1)));\n  const fallback = OPTIONS.includes(arg[0] as Option)\n    ? State.create(State.decklist(arg[0] as Option), new Random(seed(arg.slice(1))), true)\n    : State.create(State.decklist('S'), new Random(seed(arg)), true);\n  if (arg) {\n    try {\n      const s = State.decode(decodeURIComponent(arg), true);\n      if (!State.verify(s).length) return s;\n    } catch {\n      return fallback;\n    }\n  }\n  return fallback;\n})();\n\nconst result = state.search({cutoff: 1e7, prescient: false, width: 0.5});\n\nconst content = document.getElementById('content')!;\nwhile (content.firstChild) content.removeChild(content.firstChild);\n\nif (!('path' in result)) {\n  const div = createElement('div');\n  div.textContent = `Unsuccessfully searched ${result.visited} states.`;\n  content.appendChild(div);\n  content.appendChild(createElement('br'));\n  content.appendChild(lose(state));\n} else {\n  const div = createElement('div');\n  div.textContent = `Found a path of length ${result.path.length} after searching ${result.visited} states:`;\n  content.appendChild(div);\n  content.appendChild(createElement('br'));\n  content.appendChild(win(result.path, result.trace!));\n}\n"],"names":["$4728382ffb959750$var$render","s","rendered","banished","graveyard","appendChild","$iPHaw","renderState","wrapper","createElement","details","summary","code","pre","textContent","toString","next","map","key","score","$l7khe","State","decode","toFixed","join","$4728382ffb959750$var$state","arg","window","location","hash","search","slice","seed","n","Random","isNaN","Math","random","fallback","OPTIONS","includes","create","decklist","decodeURIComponent","verify","length","$4728382ffb959750$var$result","cutoff","prescient","width","$4728382ffb959750$var$content","document","getElementById","firstChild","removeChild","div","path","visited","trace","root","last","major","ul","line","startsWith","li","activated","DATA","exec","id","endsWith","undefined","track","span","innerHTML","replace","_","g","$4728382ffb959750$var$win","$4728382ffb959750$var$lose"],"version":3,"file":"index.8d147790.js.map"}