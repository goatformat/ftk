# Library FTK

<p align="center">
  <img alt="Library FTK Decklist" src="https://user-images.githubusercontent.com/117249/138643376-0218feb1-981a-4810-8c5e-df96314b85da.png" />
</p>

"[Goat Format](https://www.goatformat.com/whatisgoat.html)" refers to a legacy [Yu-Gi-Oh!
TCG](https://en.wikipedia.org/wiki/Yu-Gi-Oh!_Trading_Card_Game) format that existed in 2005, named
after the prevalance of the card [Scapegoat](https://yugioh.fandom.com/wiki/Scapegoat) during this
time period. It is a format that is still widely played today using the same card pool, ruleset, and
banlist, though in the intervening years a variety of new decks have surfaced, perhaps the most
notorious of which being "[**Library FTK**](https://www.goatformat.com/library-ftk.html)".
"[FTK](https://yugioh.fandom.com/wiki/First_Turn_Kill)" decks are historically stigmatized by the
community as they typically TODO

The project exists to fully explore "Library FTK"



## Overview

https://en.wikipedia.org/wiki/Yu-Gi-Oh!_Trading_Card_Game#Gameplay


TODO how yugioh works, how Library alters it.


### Cards

- **3 × [A Feather of the Phoenix](https://yugioh.fandom.com/wiki/A_Feather_of_the_Phoenix)** (`F`): A
  Feather of the Phoenix serves three main purposes - to draw cards by reusing the "power spells"
  (Graceful Charity / Pot of Greed / Giant Trunade), to stack the top of the deck when setting up
  for the Reversal Quiz win condition, or to recover one of the pieces of the win condition (Black
  Pendant / Reversal Quiz) if they were discarded early on. Ideally where possible a monster should
  be discarded for A Feather of the Phoenix's cost to that it can be brought back with Premature
  Burial and get around the summoning limit. A Feather of the Phoenix is relatively useful
  throughout the game, though care must be taken to ensure that there is a way to draw the card that
  gets stacked on the deck.
- **3 × [Archfiend's Oath](https://yugioh.fandom.com/wiki/Archfiend%27s_Oath)** (`O`): Archfiend's Oath
  allows for drawing cards and for paying lifepoints, both of which are critical for acheiving the
  deck's win condition. Archfiend's Oath has several important synergies in the deck - Convulsion of
  Nature and A Feather of the Phoenix allows us to know which card to declare, and Giant Trunade
  allows us to reuses Archfiend's Oath's effect multiple times in a turn (racking up Spell Counter's
  as you do). Even if we are not aware of the top card, paying to activate Archfiend's Oath's effect
  can be advantageous purely to get closer to the required 500 LP threshold to activate the win
  condition and to thin the deck (guessing the top card is also an option, either based on the
  statistically likely result or based on what would be most useful at that stage). It is important
  to note that Archfiend's Oath can also be played purely as a reusable way to increment Spell
  Counter's without needing to use its actual effect of paying to draw a card if lifepoints are a
  concern, though if starting from 8000 LP there's usually more than enough to not have to worry
  about whether or not to pay to draw as well (in the late game its often the case that there is
  more draw power than cards left in the deck, and finding a way to spend lifepoints without
  [decking out](https://yugioh.fandom.com/wiki/Deck_out) is a concern).
- **1 × [Black Pendant](https://yugioh.fandom.com/wiki/Black_Pendant)** (`B`): Black Pendant is a
  required piece of the win condition, as if it is equipped to a monster on the field when Reversal
  Quiz is activated it will inflict the finishing blow to the opponent. However, it can also serve a
  purpose in the mid-game, as once equipped to a monster it stays on the field, meaning it can be
  returned to the hand by Giant Trunade, effectively making it a resuable source of counters on any
  face-up Royal Magic Library cards. In the early game its generally safe to discard as we will
  usually be able to use A Feather of the Phoenix or Spell Reproduction to get it back, though there
  are usually less valuable spell cards to look to discard first.
- **1 × [Card Destruction](https://yugioh.fandom.com/wiki/Card_Destruction)** (`C`): Card Destruction
  (and its little brother, Reload) shine primarily at the very beginning of the game as a way to
  effectively perform a "mulligan" and dig out of a state lacking draw power. Implicitly, the value
  of Card Destruction depends on the current value of the rest of the hand, with it being most
  useful when the lowest value cards are all in the hand. If there is a lone Thunder Dragon in hand,
  discarding it before playing Card Destruction in order to deck thin *and* get an extra card to
  draw after playing Card Destruction is almost always optimal. Very few cards make sense to set
  before playing Card Destruction - if there is a draw spell in the hand it should usually be played
  first before throwing away the hand, though setting Giant Trunade or a partial piece of the
  Archfiend's Oath / Convulsion of Nature draw engine can make sense. Card Destruction inherently
  involves risk, but is incredibly powerful for being able to rescue games which would otherwise not
  be winnable.
- **3 × [Convulsion of Nature](https://yugioh.fandom.com/wiki/Convulsion_of_Nature)** (`V`):
  - reusable 1/3
  - increases power of shuffle cards (can force reshuffles to get better draws)
  - large booster for archfiends oath
- **3 × [Giant Trunade](https://yugioh.fandom.com/wiki/Giant_Trunade)** (`T`):
  - can reuse all current activated spell cards = always want to get spell counters as high as
    possible by playing all continuous beforehand
  - should be able to judge next state after trunade was played to tell how positive
- **1 × [Graceful Charity](https://yugioh.fandom.com/wiki/Graceful_Charity)** (`G`):
  - can use to get more cards and get rid of bad cards = ie. graceful - 2 TD = +3
- **2 × [Level Limit - Area B](https://yugioh.fandom.com/wiki/Level_Limit_-_Area_B)** (`A`): Level Limit
  - Area B is one of the least valuable Spell cards, serving simply as a reusable way to increment
    Spell Counters on any face-up Royal Magical Library cards, however, in the event the deck is not
    able to win on the first turn Level Limit - Area B exists as the sole source of protection for
    your monsters and lifepoints. Level Limit - Area B is usually going to end up as one of the best
    cards to discard for cost when making a push for game.
- **1 × [Pot of Greed](https://yugioh.fandom.com/wiki/Pot_of_Greed)** (`P`): Renowned for being one of
  the most complicated cards to understand in Yu-Gi-Oh!, Pot of Greed is also one of the most
  powerful cards in the deck and is often a good target for A Feather of the Phoenix or Spell
  Reproduction's recursion (provided Graceful Charity isn't in play and Giant Trunade looping isn't
  an option). Like with the other draw spells it can be saved for when the draw engine stalls out,
  though generally is better to play sooner as getting it in to the Graveyard early on allows for
  reuse potential.
- **1 × [Premature Burial](https://yugioh.fandom.com/wiki/Premature_Burial)** (`K`): Premature Burial is
  useful for getting multiple Royal Magical Library cards on the field, as its effect to Special
  Summon monsters bypasses the regular Normal Summon limit. It can also be reused via Great Trunade
  and its 800 LP cost is helpful for getting in range of the win condition. Premature Burial depends
  on having monsters in the Graveyard, so prioritizing discarding monsters via Card Destruction or A
  Feather of the Phoenix is important for unlocking Premature Burial's potential.
- **3 × [Reload](https://yugioh.fandom.com/wiki/Reload)** (`R`): Like with Card Destruction, Reload
  provides the ability to "mulligan" the hand, with the caveat that it comes at the cost of a card
  and has the potential to redraw the same cards. Like with Card Destruction it is generally most
  useful early game in order to set up a draw engine, but it often has more utility (though still
  limited) than Card Destruction in the late game as at that point the uncertainty about what the
  possible cards could be post-Reload becomes fairly low and it's generally possible to make a
  pretty good evaluation about whether the cards remaining in the deck are better than the hand.
  Because Reload does not destroy cards it is still possibly advantageous to play it in scenarios
  where Card Destruction would result in too much lost value. Similar strategies around deck
  thinning pre-activation, grabbing both Thunder Dragon cards, and setting cards before playing that
  are discussed above with Card Destruction also apply to Reload.
- **1 × [Reversal Quiz](https://yugioh.fandom.com/wiki/Reversal_Quiz)** (`Q`): Reversal Quiz has exactly
  zero value (possibly negative value, given that playing it prematurely will guarantee a loss
  except in very situational multi-turn lines of play) until the very last action of the game in
  which case it serves as the win condition. As such, Reversal Quiz is usually very safe to discard
  in the early game as it doesn't serve a purpose and there are multiple ways to recover it when
  needed (late game there are generally much more resources available to fufill the cost of the
  recursion spells).
- **3 × [Royal Magical Library](https://yugioh.fandom.com/wiki/Royal_Magical_Library)** (`L`): The
  eponymous hero of the deck (though "Library FTK" is sometimes know as a "[Reversal Quiz
  OTK](https://yugioh.fandom.com/wiki/Reversal_Quiz_OTK)", and Giant Trunade is arguably the true
  star of the show), summoning Royal Magical Library to the field as soon as possible is pretty much
  the name of the game at the beginning. Due to the amount of Spell cards being played in the deck a
  single Royal Magical Library can be responsible for drawing 5-10 cards (or more) over the course
  of the game. Multiple Royal Magical Library cards can be established via Premature Burial, an
  event which all but guarantees victory most of the time (because of this, unlike other monsters
  Royal Magical Library also has some value in the hand even after a monster has been summoned as it
  is the highest value discard target of any card in the deck). TODO
  - monsters need to have some value on the field to incentvize summoning/discarding
  - when at 3/3, need to be
- **3 × [Spell Reproduction](https://yugioh.fandom.com/wiki/Spell_Reproduction)** (`Z`):
  - useful for bringing back high value draw spells, win con pieces, trunade, premature
  - better late game when things in graveyard
- **3 × [Thunder Dragon](https://yugioh.fandom.com/wiki/Thunder_Dragon)** (`Y`):
  - can force shuffles
  - value = deck thinning (n/N)
  - can force shuffles
  - useful for card D
  - can tribute over to proc Sangan brought back via Premature
- **3 × [Toon Table of Contents](https://yugioh.fandom.com/wiki/Toon_Table_of_Contents)** (`X`):
  - value = deck thining (n/N)
  - can fetch reusable 1/3 + 1000 LP card
  - wait for library
  - can force shuffles
- **2 × [Toon World](https://yugioh.fandom.com/wiki/Toon_World)** (`W`): The search target for Toon
  Table of Contents, Toon World also serves as the most efficient way to resuably pay the lifepoints
  required for the win condition (while accumulating Spell Counters) via its 1000 LP activation
  cost. Toon World should be played relatively sparingly in the early game as lifepoints might be
  needed as a resource to pay for Archfiend's Oath's cost, though in the late game it is often the
  case that one or more Toon World cards will be recurred via Giant Trunade to quickly pay the
  required lifepoints necessary to win. One Toon World is usually sufficient and additional copies
  are generally safe to discard if necessary.
- **2 × [Upstart Goblin](https://yugioh.fandom.com/wiki/Upstart_Goblin)** (`U`): Purely used for deck
  thinning, with no downsides since the opponent's lifepoints don't matter for the win condition to
  work. There isn't really a *wrong* time to play Upstart Goblin, though it is likely to be most
  valuable when the draw engine is otherwise stuck as it can potentially unblock things.

#### Options

One of the following cards needs to be selected to bring the deck up to mininum deck size of 40
cards. Cyber Jar is likely to be most useful in actual gameplay, but for the purposes of the a
single turn interaction-less playout only Different Dimension Capsule (and theoretically Sangan)
have any positive utility:

- **1 × [Cyber Jar](https://yugioh.fandom.com/wiki/Cyber_Jar)**  (`J`): Cyber Jar has no potential
  to activate its Flip Effect during the first turn meaning it is effectively a vanilla monster in
  terms of the FTK (which still has marginal utility when played face-up as serving as the target to
  equip Black Pendant to for the win condition). However, in multi-turn playouts Cyber Jar can be
  tremendously powerful as it serves as a draw-5 and a way to get multiple Royal Magical Library
  cards on the field all at once, bypassing summoning restrictions. If there is no way to win on the
  first turn, ending with a set Cyber Jar is probably the best option for being able to go off on
  the next turn.
- **1 × [Different Dimension Capsule](https://yugioh.fandom.com/wiki/Different_Dimension_Capsule)**
  (`D`): Different Dimension Capsule effectively functions as a reusable deck-thinning mechanism.
  While theoretically Different Dimension Capsule could be used for its intended purpose to
  eventually retrieve the card it banished, in actuality the game will be over far before the
  banished card would return. Instead, Different Dimension Capsule can be returned to the hand via
  Giant Trunade to repeatedly banish the lowest value card from the deck (forcing shuffles and
  incrementing Spell Counters as it does so). This can also be helpful in the end-game for banishing
  the remaining Monster cards from the deck to be able to resolve Reversal Quiz successfully.
- **1 × [Heavy Storm](https://yugioh.fandom.com/wiki/Heavy_Storm)**  (`H`): When attempting to
  execute the FTK, Heavy Storm is strictly the worst card after Royal Decree - at best it is worth
  some Spell Counters and frees up Spell & Trap Zones, though at the cost of wiping out useful
  resources. However, Heavy Storm is one of the cards most likely to be sided in for Games 2 and 3,
  as seeing it in the early game can allow you to wipe out an opponent's opportunities for
  interruption (eg. in the form of [Solemn
  Judgment](https://yugioh.fandom.com/wiki/Solemn_Judgment)) that might otherwise disrupt your game
  plan.
- **1 × [Royal Decree](https://yugioh.fandom.com/wiki/Royal_Decree)**  (`E`): The sole Trap card,
  like Heavy Storm, Royal Decree is worse than useless when attempting an FTK (it serves only as
  discard fodder, as it can't increment Spell Counters and permanently blocks off one of the Spell &
  Trap Zones), though is potentially game winning if sided in for Games 2 and 3 as it can prevent
  forms of disruption like Solemn Judgment and protect against other alternative win-condition decks
  like [Burn](https://yugioh.fandom.com/wiki/Burn_Deck). While up to 3 Royal Decree cards can be
  played, given the power of the deck to be able to draw through the entire deck in a single turn it
  is rarely necessary to ever play more than one. In general, Royal Decree is discouraged given the
  handicap it inflicts - given the base win rate of the deck attempting to win faster is usually
  more useful than attempting to protect against losing.
- **1 × [Sangan](https://yugioh.fandom.com/wiki/Sangan)** (`S`): Sangan serves as a way to search
  for a Royal Magical Library, though given only one Monster may be summoned per turn this has
  limited value in single-turn play outside of incredibly far-fetched lines of play (ie. returning a
  discarded Sangan via Premature Burial to Tribute Summon a Thunder Dragon to search for a Royal
  Magical Library that can then be brought back by Premature Burial). Cyber Jar is generally more
  useful in open play as getting a chance to activate its effect is more likely and it results in a
  bigger payoff, though in terms of a single-turn interaction-less simulation Sangan has marginally
  more utility than Cyber Jar's zero. One additional possible use for Sangan is to serve as the
  necessary Monster to equip Black Pendant to in order to meet the requirements for the win
  condition, though it's also incredibly likely that the win condition is reached without seeing any
  Royal Magical Library that couldn't be summoned instead.

## Heuristics

In all cases, keep set for in location, same ID in same location = same score? combination of
immediate value + potential value - trunade with td td td sangan in hand is low value, but with oath
oath oath convulsion its very high value deck thin = value depends on value of cards left in deck +
how it helps get to win condition everything is expected value +1/3 not that useful if the card to
be drawn isn't very good

http://idm-lab.org/bib/abstracts/papers/ijcai05a.pdf
https://www.cs.unh.edu/~ruml/cs730/paper-examples/wilt.pdf

Different Dimension Capsule is relatively problematic for search as it explodes the state space with
its high branching factor. Reload and Card Destruction as well

## Future Work

### Performance

- Smi optimization: scores and IDs as smis (need to set bits instead of creating strings)
- DCE of trace (avoid creating the strings in the first place to avoid memory churn)
  https://github.com/terser/terser#conditional-compilation

### Multi-turn

### Probabilistic

### Monte Carlo Tree Search (MCTS)

- fully random MCTS selections dont work, need to be heuristic guided to find path at all
- random playouts part of MCTS involves not knowing what true starting state is
  - play N
- full length MCTS (search from root multiple times with different shuffles)

### Simulator UI

- "solitaire"
- ui generates only legal games, lets you play out (or reset/undo)
- click and play available options, auto tracks counters and convulsion etc = fully automated
  simulator for very confined space


---


TODO stats

TODO change image to cyber jar, default do cyber jar

- theoretical win rates
  - comparing options
- chance of going off on turn 1 (2, 3, etc)
  - with various cards
- what (combination) cards needed in hand to go off
- optimal strategies (determine flow chart for human play?)

## Design

- consistent RNG (aggregate over N games, can't play out from every possible seed unless doing MCTS)
- minimal state representation
  - equips
- insertion short (lists < 40)
- all assumptions hardcoded (limited card pool = only 2 equips, all interactions can be considered,
  sangan)
- card by card highlights
- symmetry (also cull redundant states like Set)
- state generation
- state space (heuristic ranking, BULB search)
- "known" final card for Oath/Quiz



counters

https://www.youtube.com/watch?v=E2h7NmsiJUI
https://www.youtube.com/watch?v=xwuBMx4Mca0

Side Deck

attacking with library into set cards


Prohibition (Giant Trunade), Cursed Seal of the Forbidden Spell, Cyber-Stein => Dark Balter the Terrible, Last Warrior, Ojama Trio
