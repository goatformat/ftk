{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-0fee6fbc86d76dad.js","html/sim/sim.ts","html/sim/swipe.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-9a030d0cd64e601e.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"gcU1a\\\":\\\"index.aca15800.js\\\",\\\"9JOvB\\\":\\\"worker.75bb9c50.js\\\",\\\"kpOvT\\\":\\\"index.c9f6f4eb.js\\\"}\"));","import * as workerpool from 'workerpool';\n\nimport {State, Random, ID, Formatter, DeckID, Card, DATA, FieldID, Location, Ids, Option, OPTIONS} from '../../src';\nimport {createElement, renderState, track, makeCard, CMP} from '../common';\n\nimport './swipe';\n\ntype Action = {\n  type: 'play' | 'win' | 'lose';\n} | ActionState & ({\n  type: 'target';\n} | {\n  type: 'search';\n  options: [Location, number][];\n  fallback?: Card;\n});\n\ninterface ActionState {\n  origin: {location: Location; i: number};\n  filter: (location: Location, id: DeckID | FieldID, i: number) => boolean;\n  fn: (location: Location, ...j: number[]) => void;\n  num: number;\n  targets: [Location, number][];\n}\n\ninterface Context {\n  state: State;\n  banished: DeckID[];\n  graveyard: ID[];\n  action: Action;\n}\n\nlet STATE!: {\n  option: Option;\n  num: number;\n  start: State;\n  stack: Context[];\n  index: number;\n};\n\nconst BLUE_EYES = {\n  name: 'Blue-Eyes White Dragon',\n  type: 'Monster',\n  attribute: 'Light',\n  level: 8,\n  atk: 3000,\n  def: 2500,\n  text: '<i>Dragon â€“ This legendary dragon is a powerful engine of destruction. Virtually invincible, very few have faced this awesome creature and lived to tell the tale.</i>',\n};\nfunction update(mutate = true) {\n  const $content = document.getElementById('content')!;\n  while ($content.firstChild) $content.removeChild($content.firstChild);\n\n  const {state: s, banished, graveyard, action} = STATE.stack[STATE.index];\n  const trace = renderTrace(s, banished, graveyard, mutate);\n\n  const wrapper = createElement('div', 'wrapper');\n  wrapper.appendChild(renderState(s, banished, graveyard, handler, transform, true, `${STATE.option}${STATE.num}`));\n\n  if (action.type === 'win' || (action.type === 'play' && !s.clone().next().length)) {\n    const modal = createElement('div', 'modal', 'end', action.type === 'win' ? 'win' : 'lose');\n    const a = createElement('a');\n    a.href = `../trace?${encodeURIComponent(STATE.start.encode())}`;\n    const end = createElement('h1');\n    end.textContent = `You ${action.type === 'win' ? 'Win' : 'Lose'}`;\n    a.appendChild(end);\n    modal.appendChild(a);\n    wrapper.appendChild(modal);\n    const overlay = createElement('div', 'modal-overlay');\n    wrapper.appendChild(overlay);\n\n    // TODO: add restart\n  } else if (action.type === 'search') {\n    const modal = createElement('div', 'modal');\n    const zone = createElement('div', 'zone', 'search');\n\n    if (action.fallback) {\n      zone.appendChild(makeCard(action.fallback, () => {\n        STATE.stack[STATE.index].action = {type: 'play'};\n        action.fn('deck', -1);\n        update();\n      }, {hold: true}));\n    }\n    for (const [location, i] of action.options) {\n      const id = s[location][i] as FieldID;\n      const card = ID.decode(id);\n      zone.appendChild(makeCard(card, () => handler(location, id, i), {\n        hold: true,\n        className: transform(location, id, i, true),\n      }));\n    }\n\n    modal.appendChild(zone);\n    wrapper.appendChild(modal);\n\n    const overlay = createElement('div', 'modal-overlay');\n\n    overlay.addEventListener('click', () => {\n      if (action.num < 0) {\n        const {unique, remaining} = uniqueness();\n        console.log(unique, remaining);\n        if (unique.size === 1) {\n          STATE.stack[STATE.index].action = {type: 'play'};\n          // PRECONDITION: all targets have the same location\n          const loc = (action.targets.length ? action.targets : remaining)[0][0];\n          return action.fn(loc, ...[...action.targets.map(t => t[1]), ...remaining.map(t => t[1])]);\n        }\n        return;\n      }\n      STATE.stack[STATE.index].action = {type: 'play'};\n      if (action.num > 1 && action.targets.length) {\n        return action.fn(action.targets[0][0], action.targets[0][1]);\n      } else {\n        update();\n      }\n    }, {once: true});\n\n    wrapper.appendChild(overlay);\n  }\n\n  $content.appendChild(wrapper);\n  if (trace) {\n    $content.appendChild(trace);\n    trace.scrollTop = trace.scrollHeight;\n  }\n}\n\nfunction transform(location: Location, id: FieldID, i: number, isSearch = false) {\n  const {state, action} = STATE.stack[STATE.index];\n  const pile = (['banished', 'graveyard', 'deck'].includes(location));\n  if (action.type === 'play') {\n    if (pile) return undefined;\n    const card = ID.decode(id);\n    if (card.id === Ids.ReversalQuiz && !CAN_QUIZ(state)) return 'disabled';\n    const can = card.type === 'Monster'\n      ? (location === 'hand'\n        ? ((!state.summoned && state.monsters.length < 5) ||\n          (card.id === Ids.ThunderDragon && state.deck.length))\n        : (ID.get(id) === 3 && state.deck.length))\n      : (location === 'hand'\n        ? state.spells.length < 5 && card.can(state, location)\n        : ID.facedown(id)\n          ? card.can(state, location as 'spells')\n          : (card.id === Ids.ArchfiendsOath && !ID.get(id) && state.deck.length));\n    return can ? undefined : 'disabled';\n  } else if (action.type === 'target' || action.type === 'search') {\n    if (location === action.origin.location && i === action.origin.i) return 'selected';\n    if (!action.filter(location, id, i)) return pile ? undefined : 'disabled';\n    if (action.targets.find(([loc, j]) => loc === location && j === i)) {\n      if (!isSearch && action.type === 'search' && location === action.options[0][0]) {\n        return undefined;\n      }\n      return 'option';\n    }\n    return undefined;\n  }\n  return undefined;\n}\n\nfunction renderTrace(s: State, banished: DeckID[], graveyard: ID[], mutate = true) {\n  if (!s.trace?.length) return undefined;\n\n  const trace = createElement('div', 'trace');\n  let p = createElement('p');\n  let ul = createElement('ul');\n\n  let last = '';\n  let major = 0;\n  for (const line of s.trace) {\n    const minor = line.startsWith('  ');\n    if (!minor) {\n      if (major) {\n        p.appendChild(ul);\n        ul = createElement('ul');\n        trace.appendChild(p);\n        p = createElement('p');\n      }\n      last = line;\n      major++;\n\n      const span = createElement('span');\n      span.innerHTML = line.replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n      p.appendChild(span);\n    } else {\n      const li = createElement('li');\n      li.textContent = line;\n      ul.appendChild(li);\n    }\n  }\n\n  p.appendChild(ul);\n  ul = createElement('ul');\n  trace.appendChild(p);\n\n  if (last && mutate) {\n    const activated = last.startsWith('Activate')\n      ? DATA[/\"(.*?)\"/.exec(last)![1]].id\n      : (last.startsWith('Set') && !last.endsWith('face-down'))\n        ? DATA[/then activate(?: face-down)? \"(.*?)\"/.exec(last)![1]].id\n        : undefined;\n    track(s.banished, banished, activated);\n    track(s.graveyard, graveyard, activated);\n  }\n\n  return trace;\n}\n\nfunction SPELL(fn?: (s: State) => void) {\n  return (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.remove(location, i);\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    if (card.type === 'Spell' && card.subType === 'Continuous') {\n      s.add('spells', card.id);\n    } else {\n      s.add('graveyard', card.id);\n    }\n    if (fn) fn(s);\n    s.inc();\n    update();\n  };\n}\n\nfunction ARCHFIEND(s: State, location: 'hand' | 'spells', i: number, card: Card) {\n  const play = location === 'hand' || ID.facedown(s[location][i]);\n  const prefix = play\n    ? `Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\" then pay`\n    : 'Pay';\n  const major = `${prefix} 500 LP (${s.lifepoints} -> ${s.lifepoints - 500}) to activate effect of \"${card.name}\"`;\n  if (s.known()) {\n    s.major(major);\n    s.lifepoints -= 500;\n\n    s.minor(`Declare \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n    s.draw();\n\n    s.remove(location, i);\n    s.add('spells', ID.set(card.id, 1));\n    if (play) s.inc();\n    update();\n  } else {\n    search({location, i}, loc => loc === 'deck', (_, j) => {\n      s.major(major);\n      s.lifepoints -= 500;\n\n      const top = ID.decode(s.deck[s.deck.length - 1]);\n      if (top.id === s.deck[j]) {\n        s.minor(`Declare \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n        s.draw();\n      } else {\n        s.minor(`Declare \"${j < 0 ? 'Blue-Eyes White Dragon' : ID.decode(s.deck[j]).name}\"`);\n        const reveal = ID.decode(s.deck.pop()!);\n        s.minor(`Excavate \"${reveal.name}\"`);\n        s.add('graveyard', reveal.id);\n      }\n\n      s.remove(location, i);\n      s.add('spells', ID.set(card.id, 1));\n      if (play) s.inc();\n      update();\n    }, 1, BLUE_EYES as Card);\n  }\n}\n\nfunction SANGAN_TARGET(location: Location, id: DeckID | FieldID) {\n  const card = ID.decode(id);\n  return location === 'deck' && card.type === 'Monster' && card.atk <= 1500;\n}\n\nfunction RELOAD(fn: (s: State) => void) {\n  return (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    const spells = s.spells.length;\n    let max: number;\n    if (location === 'hand') {\n      const hand = s.hand.filter((id, j) => i !== j && ID.decode(id).type !== 'Monster');\n      max = Math.min(5 - spells - 1, hand.length, s.hand.length - 2);\n    } else {\n      const hand = s.hand.filter(id => ID.decode(id).type !== 'Monster');\n      max = Math.min(5 - spells, hand.length, s.hand.length - 1);\n    }\n\n    const before = s.hand.slice();\n    target({location, i}, (loc, id) => loc === 'hand' && ID.decode(id).type !== 'Monster', (_, ...set) => {\n      // NOTE: if location === 'hand' we need to adjust the offsets of any cards we set!\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n\n      const ids = [];\n      for (const [offset, j] of set.entries()) {\n        const id = before[j];\n        ids.push(id);\n        s.add('spells', ID.toggle(id) as FieldID);\n        s.remove('hand', j - offset - (location === 'hand' && i < j ? 1 : 0));\n      }\n      if (ids.length) {\n        s.major(`Set ${Formatter.names(ids)} face-down then activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      } else {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      }\n      const len = s.hand.length;\n      fn(s);\n      s.hand = [];\n      s.draw(len);\n      s.inc();\n      update();\n    }, -max);\n  };\n}\n\n// TODO: allow playing if multi-turn is supported\nfunction CAN_QUIZ(s: State) {\n  // NOTE: we have to clone for the termination check because it mutates the final state\n  if (!s.clone().end(false)) return false;\n  // The lookahead parameter only covers the A Feather of the Phoenix, end() will still return true\n  // if Black Pendant isn't actually equipped yet (but is equippable).\n  return s.spells.some(id => ID.id(id) === Ids.BlackPendant && !ID.facedown(id));\n}\n\n// TODO: allow playing if multi-turn is supported\nfunction QUIZ(s: State, location: 'hand' | 'spells') {\n  if (!CAN_QUIZ(s)) return;\n\n  const known = s.known(true)!;\n  // NOTE: We already checked that Black Pendant is equipped\n  s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"Reversal Quiz\"`);\n  // Filter out Reversal Quiz from the messages about what gets sent to the Graveyard\n  const hand = s.hand.filter(id => ID.id(id) !== Ids.ReversalQuiz);\n  if (hand.length) s.minor(`Send ${Formatter.names(hand)} from hand to Graveyard`);\n  s.graveyard.push(...hand);\n  s.hand = [];\n\n  const ids = s.monsters.map(id => ID.id(id));\n  s.graveyard.push(...ids);\n  s.monsters = [];\n\n  for (const id of s.spells) {\n    const card = ID.decode(id);\n    if (card.id !== Ids.ReversalQuiz) {\n      continue;\n    } else if (!ID.facedown(id)) {\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.graveyard.push(card.id);\n    ids.push(card.id);\n  }\n  s.spells = [];\n  s.graveyard.sort(CMP);\n  if (ids.length) s.minor(`Send ${Formatter.names(ids)} from field to Graveyard`);\n\n  // Reversal Quiz isn't actually in the Graveyard at the point when the game is won\n  s.add('spells', Ids.ReversalQuiz);\n  // TODO: consider visually displaying the revealed card?\n  s.minor(`Call \"${ID.decode(known).type}\", reveal \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n  s.major(`After exchanging Life Points, opponent has ${s.lifepoints} LP and then takes 500 damage from \"Black Pendant\" being sent from the field to the Graveyard`);\n\n  STATE.stack[STATE.index].action = {type: 'win'};\n  update();\n}\n\nconst SPELLS: { [name: string]: any } = {\n  'A Feather of the Phoenix': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, loc => loc === 'hand', (_, j) => {\n      search({location, i}, loc => loc === 'graveyard', (__, k) => {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n        s.minor(`Discard \"${ID.decode(s.hand[j]).name}\"`);\n        const gid = s.remove('graveyard', k);\n        s.minor(`Return \"${ID.decode(gid).name}\" in the Graveyard to the top of the Deck`);\n        if (location === 'hand') {\n          s.discard(i < j ? [i, j] : [j, i]);\n        } else {\n          s.remove(location, i);\n          s.add('graveyard', card.id);\n          s.add('graveyard', s.remove('hand', j));\n        }\n        s.deck.push(ID.toggle(gid) as DeckID);\n        s.inc();\n        update();\n      });\n    });\n  },\n  'Archfiend\\'s Oath': SPELL(),\n  'Black Pendant': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, loc => loc === 'monsters', (_, j) => {\n      s.remove(location, i);\n      s.major(`${location === 'spells' ? `Flip face-down \"${card.name}\" and equip` : `Equip \"${card.name}\"`} to \"${ID.decode(s.monsters[j]).name}\"`);\n      s.add('spells', ID.set(card.id, j));\n      s.inc();\n      update();\n    });\n  },\n  'Card Destruction': RELOAD(s => {\n    for (const id of s.hand) {\n      s.add('graveyard', id);\n    }\n    s.minor(`Discard ${Formatter.names(s.hand)}`);\n  }),\n  'Card Shuffle': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    const reuse = location === 'spells' && !ID.facedown(s[location][i]);\n    if (reuse) {\n      s.major(`Activate effect of \"${card.name}\"`);\n    } else {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    }\n\n    s.remove(location, i);\n    s.add('spells', ID.set(card.id, 1));\n    s.minor(`Pay 300 LP (${s.lifepoints} -> ${s.lifepoints - 300})`);\n    s.lifepoints -= 300;\n    s.shuffle();\n\n    if (!reuse) s.inc();\n    update();\n  },\n  'Convulsion of Nature': SPELL(s => s.reverse()),\n  'Different Dimension Capsule': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, loc => loc === 'deck', (_, j) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('spells', card.id);\n      s.minor(`Banish ${ID.decode(s.deck[j]).name} from the deck face-down`);\n      s.add('banished', ID.toggle(ID.id(s.deck.splice(j, 1)[0])) as DeckID);\n      s.shuffle();\n      s.inc();\n      update();\n    });\n  },\n  'Giant Trunade': SPELL(s => {\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      s.add('hand', card.id);\n      if (ID.facedown(id)) continue;\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.minor(`Return ${Formatter.names(s.spells)} to hand`);\n    s.spells = [];\n  }),\n  'Graceful Charity': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    s.remove(location, i);\n    i = s.add('spells', card.id);\n    s.draw(3);\n    update(); // FIXME bad partial state\n    // NOTE: we deliberately set the wrong index for the card so that it can't be cancelled\n    target({location: 'spells', i: -1}, loc => loc === 'hand', (_, j, k) => {\n      s.minor(`Discard \"${ID.decode(s.hand[j]).name}\" and \"${ID.decode(s.hand[k]).name}\"`);\n      s.discard([j, k]); // PRECONDITION: j < k\n      s.remove('spells', i);\n      s.add('graveyard', card.id);\n      s.inc();\n      update();\n    }, 2);\n  },\n  'Level Limit - Area B': SPELL(),\n  'Pot of Greed': SPELL(s => s.draw(2)),\n  'Premature Burial': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, (loc, id) => loc === 'graveyard' && ID.decode(id).type === 'Monster', (_, j) => {\n      s.major(`Pay 800 LP (${s.lifepoints} -> ${s.lifepoints - 800}) to activate effect of \"${card.name}\"`);\n      s.minor(`Special Summon \"${ID.decode(s.graveyard[j]).name}\" in Attack Position from Graveyard`);\n      s.lifepoints -= 800;\n      const gid = s.remove('graveyard', j);\n      const zone = s.summon(gid, true);\n      s.remove(location, i);\n      s.add('spells', ID.set(card.id, zone));\n      s.inc(zone);\n      update();\n    });\n  },\n  'Heavy Storm': SPELL(s => {\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      s.add('graveyard', card.id);\n      if (ID.facedown(id)) continue;\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.BlackPendant) {\n        s.mset(ID.get(id));\n      } else if (card.id === Ids.PrematureBurial) {\n        const removed = s.mremove(ID.get(id));\n        s.add('graveyard', removed.id);\n        s.minor(`Sending \"${ID.decode(removed.id).name}\" to the Graveyard after its equipped \"${ID.decode(id).name}\" was destroyed`);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.minor(`Send ${Formatter.names(s.spells)} to Graveyard`);\n    s.spells = [];\n  }),\n  'Reload': RELOAD(s => {\n    s.deck.push(...s.hand);\n    s.minor(`Return ${Formatter.names(s.hand)} to Deck`);\n    s.shuffle();\n  }),\n  'Reversal Quiz': (s: State, location: 'hand' | 'spells', i: number, self: Card) => {\n    let sangan = false;\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${self.name}\"`);\n    if (s.hand.length) {\n      s.minor(`Send ${Formatter.names(s.hand)} from hand to Graveyard`);\n    }\n    if (s.monsters.length || s.spells.length) {\n      s.minor(`Send ${Formatter.names([...s.monsters, ...s.spells])} from field to Graveyard`);\n    }\n\n    s.graveyard.push(...s.hand);\n    s.hand = [];\n    for (const id of s.monsters) {\n      const card = ID.decode(id);\n      if (card.id === Ids.Sangan) sangan = true;\n      s.graveyard.push(card.id);\n    }\n    s.monsters = [];\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      if (!ID.facedown(id)) {\n        if (card.id === Ids.ConvulsionOfNature) {\n          s.reverse(true);\n        } else if (card.id === Ids.DifferentDimensionCapsule) {\n          s.banish();\n        }\n      }\n      s.graveyard.push(card.id);\n    }\n    s.spells = [];\n    s.graveyard.sort(CMP);\n\n    const reveal = s.deck[s.deck.length - 1];\n    if (!ID.known(reveal)) s.deck[s.deck.length - 1] = ID.toggle(reveal) as DeckID;\n    // BUG: we are deliberately peeking here to ensure we call it wrong!\n    const card = ID.decode(reveal);\n    s.minor(`Call \"${card.type === 'Trap' ? 'Monster' : 'Trap'}\", reveal \"${card.name}\"`);\n    if (!sangan) return update();\n\n    search({location, i}, SANGAN_TARGET, (_, j) => {\n      if (j < 0) {\n        s.minor('Fail to find \"Sangan\" target in Deck');\n      } else {\n        const id = ID.id(s.deck.splice(j, 1)[0]);\n        s.minor(`Add \"${ID.decode(id).name}\" from Deck to hand after \"Sangan\" was sent to the Graveyard`);\n        s.add('hand', id);\n      }\n      s.shuffle();\n      update();\n    });\n  },\n  // TODO: handle flipping Royal Decree in multi-turn scenarios\n  'Royal Decree': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.remove(location, i);\n    if (location === 'hand') {\n      s.major(`Set \"${card.name}\" face-down`);\n      s.add('spells', ID.toggle(card.id) as FieldID);\n    } // else {\n    //   s.major(`Activate face-down' \"${card.name}\"`);\n    //   s.add('spells', card.id);\n    // }\n    update();\n  },\n  'Spell Reproduction': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, (loc, id) => loc === 'hand' && ID.decode(id).type === 'Spell', (_, j, k) => {\n      search({location, i}, (loc, id) => loc === 'graveyard' && ID.decode(id).type === 'Spell', (__, g) => {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n        s.minor(`Discard \"${ID.decode(s.hand[j]).name}\" and \"${ID.decode(s.hand[k]).name}\"`);\n        const gid = s.remove('graveyard', g);\n        if (location === 'hand') {\n          s.discard([i, j, k].sort(CMP));\n        } else {\n          s.remove(location, i);\n          s.add('graveyard', card.id);\n          s.discard([j, k]); // PRECONDITION: j < k\n        }\n        s.minor(`Add \"${ID.decode(gid).name}\" in the Graveyard to hand`);\n        s.add('hand', gid);\n        s.inc();\n        update();\n      });\n    }, 2);\n  },\n  'Spellbook Organization': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i: -1}, (loc, _, j) => loc === 'deck' && j >= s.deck.length - 3, (_, j, k, l) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n      s.minor(`Reveal ${Formatter.names(s.deck.slice(s.deck.length - 3).reverse())}`);\n\n      const ordered = [s.deck[j], s.deck[k], s.deck[l]];\n      s.minor(`Return ${Formatter.names(ordered)} to the Deck`);\n      for (let m = 0; m < ordered.length; m++) {\n        s.deck[s.deck.length - 1 - m] =\n          ID.facedown(ordered[m]) ? ordered[m] : ID.toggle(ordered[m]) as DeckID;\n      }\n\n      s.inc();\n      update();\n    }, -3);\n  },\n  'Toon Table of Contents': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, (loc, id) => loc === 'deck' && ID.decode(id).name.startsWith('Toon'), (_, j) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n      if (j < 0) {\n        s.minor('Fail to find \"Toon\" card in Deck');\n      } else {\n        s.minor(`Add \"${ID.decode(s.deck[j]).name}\" from Deck to hand`);\n        s.add('hand', ID.id(s.deck.splice(j, 1)[0]));\n      }\n      s.shuffle();\n      s.inc();\n      update();\n    });\n  },\n  'Toon World': SPELL(s => {\n    s.minor(`Pay 1000 LP (${s.lifepoints} -> ${s.lifepoints - 1000})`);\n    s.lifepoints -= 1000;\n  }),\n  'Upstart Goblin': SPELL(s => s.draw()),\n};\n\nfunction handler(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  console.log(action, location, id, i); // Formatter\n  switch (action.type) {\n  case 'play': return onPlay(location, id, i);\n  case 'target': return onTarget(location, id, i);\n  case 'search': return onSearch(location, id, i);\n  }\n}\n\nfunction onPlay(location: Location, id: FieldID, i: number) {\n  const state = STATE.stack[STATE.index].state;\n\n  const card = ID.decode(id);\n  switch (location) {\n  case 'monsters': {\n    if (card.id === Ids.RoyalMagicalLibrary) {\n      if (ID.facedown(id) || ID.get(id) !== 3 || !state.deck.length) return;\n      state.major(`Remove 3 Spell Counters from \"${card.name}\"`);\n      state.mset(i);\n      state.draw();\n      return update();\n    }\n    return;\n  }\n  case 'spells': {\n    if (card.type === 'Monster' || !card.can(state, location)) return;\n    if (card.id === Ids.ReversalQuiz) {\n      QUIZ(state, location);\n    } else if (ID.facedown(id)) {\n      const spell = SPELLS[card.name];\n      if (spell) spell(state, location, i, card);\n    } else if (card.id === Ids.ArchfiendsOath && !ID.get(id)) {\n      ARCHFIEND(state, location, i, card);\n    } else if (card.id === Ids.CardShuffle && !ID.get(id)) {\n      SPELLS[card.name]!(state, location, i, card);\n    }\n    return;\n  }\n  case 'hand': {\n    if (card.id === Ids.ReversalQuiz) {\n      QUIZ(state, location);\n    } else if (card.id === Ids.ThunderDragon) {\n      const find = (s: State) => {\n        search({location, i}, (loc, sid) => loc === 'deck' && ID.id(sid) === Ids.ThunderDragon, (_, ...targets) => {\n          s.major(`Discard \"${card.name}\"`);\n          s.remove('hand', i);\n          s.add('graveyard', card.id);\n          if (targets.length === 2) {\n            s.minor(`Add 2 \"${card.name}\" from Deck to hand`);\n            // PRECONDITION: targets[0] < targets[1]\n            s.add('hand', ID.id(s.deck.splice(targets[0], 1)[0]));\n            s.add('hand', ID.id(s.deck.splice(targets[1] - 1, 1)[0]));\n          } else if (targets[0] >= 0) {\n            s.minor(`Add \"${card.name}\" from Deck to hand`);\n            s.add('hand', ID.id(s.deck.splice(targets[0], 1)[0]));\n          } else {\n            s.minor(`Fail to find \"${card.name}\" in Deck`);\n          }\n          s.shuffle();\n          update();\n        }, 2);\n      };\n\n      if (state.monsters.length && state.monsters.length < 5 && !state.summoned) {\n        target({location, i}, loc => loc === 'deck' || loc === 'monsters', (loc, j) => {\n          if (loc === 'deck') {\n            find(state);\n          } else {\n            const t = ID.decode(state.monsters[j]);\n            state.major(`Tribute \"${t.name}\" to Summon \"${self.name}\"`);\n            state.tribute(j, i);\n            if (t.id === Ids.Sangan) {\n              search({location: 'graveyard', i: -1}, SANGAN_TARGET, (_, k) => {\n                if (k < 0) {\n                  state.minor('Fail to find \"Sangan\" target in Deck');\n                } else {\n                  const did = ID.id(state.deck.splice(k, 1)[0]);\n                  state.minor(`Add \"${ID.decode(did).name}\" from Deck to hand after \"Sangan\" was sent to the Graveyard`);\n                  state.add('hand', did);\n                }\n                state.shuffle();\n                update();\n              });\n            } else {\n              update();\n            }\n          }\n        });\n      } else {\n        find(state);\n      }\n    } else if (card.type === 'Monster') {\n      if (state.monsters.length >= 5 || state.summoned) return;\n      state.remove(location, i);\n      state.major(`Summon \"${card.name}\" in Attack Position`);\n      state.summon(card.id);\n      return update();\n    } else {\n      if (state.spells.length >= 5 || !card.can(state, location)) return;\n      const spell = SPELLS[card.name];\n      if (spell) spell(state, location, i, card);\n    }\n  }\n  }\n}\n\nfunction target(\n  origin: {location: Location; i: number},\n  filter: (location: Location, id: DeckID | FieldID) => boolean,\n  fn: (location: Location, ...j: number[]) => void,\n  num = 1\n) {\n  if (num === 0) return fn(origin.location);\n  const state = STATE.stack[STATE.index].state;\n\n  const targets: ['hand' | 'spells' | 'monsters' | 'deck', number][] = [];\n  for (const location of ['hand', 'spells', 'monsters'] as const) {\n    for (const [i, id] of state[location].entries()) {\n      if (location === origin.location && i === origin.i) continue;\n      if (filter(location, id)) targets.push([location, i]);\n    }\n  }\n  if (state.deck.length && filter('deck', state.deck[state.deck.length - 1] as FieldID)) {\n    targets.push(['deck', state.deck.length - 1]);\n  }\n\n  if (num > 0 && targets.length === num) {\n    // PRECONDITION: new Set(targets.map(t => t[0])).size === 1\n    return fn(targets[0][0], ...targets.map(t => t[1]).sort(CMP));\n  } else {\n    STATE.stack[STATE.index].action = {\n      type: 'target',\n      origin,\n      filter,\n      fn,\n      num,\n      targets: [],\n    };\n    update();\n  }\n}\n\nfunction onTarget(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  if (action.type !== 'target') throw new Error(`Invalid action type ${action.type}`);\n\n  if (location === action.origin.location && i === action.origin.i) {\n    STATE.stack[STATE.index].action = {type: 'play'};\n    if (action.num < 0) {\n      if (action.targets.length) {\n        // PRECONDITION: all targets have the same location\n        return action.fn(action.targets[0][0], ...action.targets.map(t => t[1]).sort(CMP));\n      } else {\n        return action.fn(location);\n      }\n    } else {\n      update();\n    }\n  } else if (action.filter(location, id, i)) {\n    const remove = action.targets.findIndex(([loc, j]) => loc === location && j === i);\n    if (remove >= 0) {\n      action.targets.splice(remove, 1);\n    } else {\n      action.targets.push([location, i]);\n    }\n\n    if (action.targets.length === Math.abs(action.num)) {\n      STATE.stack[STATE.index].action = {type: 'play'};\n      // PRECONDITION: all targets have the same location\n      return action.fn(action.targets[0][0], ...action.targets.map(t => t[1]).sort(CMP));\n    } else {\n      update();\n    }\n  }\n}\n\nfunction search(\n  origin: {location: Location; i: number},\n  filter: (location: Location, id: DeckID | FieldID, i: number) => boolean,\n  fn: (location: Location, ...j: number[]) => void,\n  num = 1,\n  fallback?: Card,\n) {\n  const state = STATE.stack[STATE.index].state;\n\n  const targets: ['graveyard' | 'deck', number][] = [];\n  const ids = new Set<ID>();\n  for (const location of ['graveyard', 'deck'] as const) {\n    for (const [i, did] of state[location].entries()) {\n      const id = ID.id(did);\n      if (location === origin.location && i === origin.i || ids.has(id)) continue;\n      if (filter(location, id, i)) {\n        if (num === 1) ids.add(id);\n        targets.push([location, i]);\n      }\n    }\n  }\n\n  if (targets.length === 0) {\n    fn('hand', -1); // NOTE: we don't actually have a valid location...\n  } else if (targets.length === 1) {\n    return fn(targets[0][0], targets[0][1]);\n  } else {\n    STATE.stack[STATE.index].action = {\n      type: 'search',\n      origin,\n      filter,\n      fn,\n      num,\n      targets: [],\n      options: num < 0 ? targets.reverse() : targets.sort((a, b) =>\n        ID.decode(state[a[0]][a[1]]).name.localeCompare(ID.decode(state[b[0]][b[1]]).name)),\n      fallback,\n    };\n    update();\n  }\n}\n\nfunction onSearch(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  if (action.type !== 'search') throw new Error(`Invalid action type ${action.type}`);\n\n  if (location === action.origin.location && i === action.origin.i) {\n    STATE.stack[STATE.index].action = {type: 'play'};\n    if (action.num > 1 && action.targets.length) {\n      return action.fn(action.targets[0][0], action.targets[0][1]);\n    } else {\n      update();\n    }\n  } else if (action.filter(location, id, i)) {\n    const remove = action.targets.findIndex(([loc, j]) => loc === location && j === i);\n    if (remove >= 0) {\n      action.targets.splice(remove, 1);\n    } else {\n      action.targets.push([location, i]);\n    }\n\n    if (action.targets.length === Math.abs(action.num)) {\n      STATE.stack[STATE.index].action = {type: 'play'};\n      // PRECONDITION: all targets have the same location\n      const targets = action.targets.map(t => t[1]);\n      return action.fn(action.targets[0][0], ...(action.num > 0 ? targets.sort(CMP) : targets));\n    } else if (action.num < 0) {\n      const {unique, remaining} = uniqueness();\n      if (unique.size === 1) {\n        STATE.stack[STATE.index].action = {type: 'play'};\n        // PRECONDITION: all targets have the same location\n        const loc = (action.targets.length ? action.targets : remaining)[0][0];\n        return action.fn(loc, ...[...action.targets.map(t => t[1]), ...remaining.map(t => t[1])]);\n      } else {\n        update();\n      }\n    } else {\n      update();\n    }\n  }\n}\n\nfunction uniqueness() {\n  const {state, action} = STATE.stack[STATE.index];\n  if (action.type !== 'search') throw new Error(`Bad action type: ${action.type}`);\n  const remaining = action.options.slice();\n  for (const [loc, j] of action.targets) {\n    remaining.splice(remaining.findIndex(([l, k]) => l === loc && k === j), 1);\n  }\n  const unique = new Set(remaining.map(([loc, j]) => ID.id(state[loc][j])));\n  return {remaining, unique};\n}\n\nfunction initialize(option: Option, num: number) {\n  console.log('Seed:', num);\n\n  const state = State.create(State.decklist(option), new Random(Random.seed(num)), true);\n\n  STATE = {\n    option,\n    num,\n    start: state.clone(),\n    stack: [{\n      state,\n      banished: [],\n      graveyard: [],\n      action: {type: 'play'},\n    } as Context],\n    index: 0,\n  };\n\n  const undo = () => {\n    // if (STATE.index) {\n    //   STATE.index--;\n    //   update(false);\n    // }\n  };\n\n  const redo = () => {\n    // if (STATE.index < STATE.stack.length - 1) {\n    //   STATE.index++;\n    //   update(false);\n    // }\n  };\n\n  const cancel = () => {\n    const action = STATE.stack[STATE.index].action;\n    if (action.type === 'target' || action.type === 'search') {\n      if (action.origin.i >= 0) {\n        STATE.stack[STATE.index].action = {type: 'play'};\n      } else {\n        (STATE.stack[STATE.index].action as ActionState).targets = [];\n      }\n      update();\n    }\n  };\n\n  const CLICKABLE = ['modal', 'modal-overlay', 'card'];\n  document.addEventListener('click', e => {\n    if (e.target instanceof Element) {\n      for (let p: Element | null = e.target; p; p = p.parentElement) {\n        if (CLICKABLE.some(c => p!.classList.contains(c))) {\n          return true;\n        }\n      }\n    }\n    cancel();\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  });\n  document.addEventListener('swiped-left', undo);\n  document.addEventListener('swiped-right', redo);\n  document.addEventListener('keydown', e => {\n    const key = e.which || e.keyCode;\n    switch (key) {\n    case 27:\n      cancel();\n      break;\n    case 37:\n      undo();\n      break;\n    case 39:\n      redo();\n      break;\n    default:\n      return true;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  });\n\n  /* eslint-disable @typescript-eslint/no-floating-promises */\n  const pool = workerpool.pool(new URL('../worker.ts', import.meta.url).pathname);\n  pool.exec('search', [STATE.start.encode(), 42, 1e6, false, 0.5]).then(r => {\n    console.log('Path:', r);\n  }).catch(e => {\n    console.error(e);\n  }).then(() => {\n    pool.terminate();\n  });\n\n  update();\n}\n\nfunction start() {\n  const arg = (window.location.hash || window.location.search).slice(1);\n  if (OPTIONS.includes(arg[0] as Option)) {\n    const n = arg.slice(1);\n    if (n && !isNaN(+n)) return initialize(arg[0] as Option, +n);\n  }\n  const num = arg && !isNaN(+arg) ? +arg : ~~(Math.random() * (2 ** 31 - 1));\n\n  const $content = document.getElementById('content')!;\n  while ($content.firstChild) $content.removeChild($content.firstChild);\n  const zone = createElement('div', 'zone', 'start');\n  for (const id of OPTIONS) {\n    const card = ID.decode(Formatter.unhuman(id));\n    zone.appendChild(makeCard(card, () => {\n      initialize(id, num);\n    }, {hold: true}));\n  }\n  $content.appendChild(zone);\n}\n\nstart();\n","/* ! Modified from John Doherty's MIT-licensed https://github.com/john-doherty/swiped-events */\n(() => {\n  'use strict';\n\n  const THRESHOLD = 100;\n  const TIMEOUT = 500;\n\n  let downX: number | null = null;\n  let downY: number | null = null;\n  let diffX = 0;\n  let diffY = 0;\n  let timeDown: number | null = null;\n  let startElement: EventTarget | null = null;\n\n  if (typeof window.CustomEvent !== 'function') {\n    // @ts-ignore\n    window.CustomEvent = (event: string, params: any) => {\n      params = params || {bubbles: false, cancelable: false, detail: undefined};\n      const e = document.createEvent('CustomEvent');\n      e.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return e;\n    };\n\n    // @ts-ignore\n    window.CustomEvent.prototype = window.Event.prototype;\n  }\n\n  function handleTouchEnd(e: TouchEvent) {\n    if (startElement !== e.target) return;\n\n    const timeDiff = Date.now() - timeDown!;\n    let eventType = '';\n\n    if (Math.abs(diffX) > Math.abs(diffY)) {\n      if (Math.abs(diffX) > THRESHOLD && timeDiff < TIMEOUT) {\n        if (diffX > 0) {\n          eventType = 'swiped-left';\n        } else {\n          eventType = 'swiped-right';\n        }\n      }\n    } else {\n      if (Math.abs(diffY) > THRESHOLD && timeDiff < TIMEOUT) {\n        if (diffY > 0) {\n          eventType = 'swiped-up';\n        } else {\n          eventType = 'swiped-down';\n        }\n      }\n    }\n\n    if (eventType) {\n      startElement!.dispatchEvent(new CustomEvent(eventType, {bubbles: true, cancelable: true}));\n    }\n\n    downX = null;\n    downY = null;\n    timeDown = null;\n  }\n\n  function handleTouchStart(e: TouchEvent) {\n    startElement = e.target;\n\n    timeDown = Date.now();\n    downX = e.touches[0].clientX;\n    downY = e.touches[0].clientY;\n    diffX = 0;\n    diffY = 0;\n  }\n\n  function handleTouchMove(e: TouchEvent) {\n    if (!downX || !downY) return;\n    diffX = downX - e.touches[0].clientX;\n    diffY = downY - e.touches[0].clientY;\n  }\n\n  document.addEventListener('touchstart', handleTouchStart, false);\n  document.addEventListener('touchmove', handleTouchMove, false);\n  document.addEventListener('touchend', handleTouchEnd, false);\n})();\n","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = require('./helpers/bundle-url').getBundleURL('gcU1a') + \"../\" + require('./helpers/bundle-manifest').resolve(\"9JOvB\");"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$365bb179207d3425$var$STATE","downX","downY","diffX","diffY","timeDown","startElement","window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","e","document","createEvent","initCustomEvent","prototype","Event","addEventListener","target","Date","now","touches","clientX","clientY","timeDiff","eventType","Math","abs","dispatchEvent","$365bb179207d3425$var$BLUE_EYES","name","type","attribute","level","atk","def","text","$365bb179207d3425$var$update","mutate","$content","getElementById","firstChild","removeChild","state","s","banished","graveyard","action","stack","index","trace","$iPHaw","createElement","p","ul","last","major","line","startsWith","li","textContent","appendChild","span","innerHTML","replace","_","g","activated","$l7khe","DATA","exec","endsWith","track","$365bb179207d3425$var$renderTrace","wrapper","renderState","$365bb179207d3425$var$handler","$365bb179207d3425$var$transform","option","num","clone","next","modal","a","href","encodeURIComponent","start","encode","end","overlay","zone","fallback","makeCard","fn","hold","location","options","card","ID","decode","className","unique","remaining","$365bb179207d3425$var$uniqueness","console","log","size","loc","targets","map","t","once","scrollTop","scrollHeight","isSearch","pile","includes","Ids","ReversalQuiz","$365bb179207d3425$var$CAN_QUIZ","summoned","monsters","ThunderDragon","deck","get","spells","can","facedown","ArchfiendsOath","origin","filter","find","j","$365bb179207d3425$var$SPELL","remove","subType","add","inc","$365bb179207d3425$var$SANGAN_TARGET","$365bb179207d3425$var$RELOAD","max","hand","min","before","slice","$365bb179207d3425$var$target","set","ids","offset","entries","push","toggle","Formatter","names","len","draw","some","BlackPendant","$365bb179207d3425$var$QUIZ","known","minor","ConvulsionOfNature","reverse","DifferentDimensionCapsule","banish","sort","CMP","lifepoints","$365bb179207d3425$var$SPELLS","$365bb179207d3425$var$search","__","k","gid","discard","reuse","shuffle","splice","summon","mset","PrematureBurial","removed","mremove","Reload","self","sangan","Sangan","id1","reveal","l","ordered","m","RoyalMagicalLibrary","spell","CardShuffle","play","pop","$365bb179207d3425$var$ARCHFIEND","sid","tribute","did","$365bb179207d3425$var$onPlay","findIndex","$365bb179207d3425$var$onTarget","$365bb179207d3425$var$onSearch","Set","has","b","localeCompare","$365bb179207d3425$var$initialize","State","create","decklist","Random","seed","undo","redo","cancel","CLICKABLE","Element","parentElement","c","classList","contains","preventDefault","stopPropagation","which","keyCode","pool","$ahpAG","URL","$909bf99daf4f11a7$exports","pathname","then","r","catch","error","terminate","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","value","err","matches","match","$f29cd6c67ea13581$var$getBundleURL","getBundleURL","resolve","arg","hash","search","OPTIONS","n","isNaN","random","unhuman","$365bb179207d3425$var$start"],"version":3,"file":"index.aca15800.js.map"}