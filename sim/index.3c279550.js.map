{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-a73bf6c38c137c19.js","node_modules/workerpool/dist/webpack:/workerpool/webpack/universalModuleDefinition","node_modules/workerpool/dist/webpack:/workerpool/src/Pool.js","node_modules/workerpool/dist/webpack:/workerpool/src/Promise.js","node_modules/workerpool/dist/webpack:/workerpool/src/WorkerHandler.js","node_modules/workerpool/dist/webpack:/workerpool/src/debug-port-allocator.js","node_modules/workerpool/dist/webpack:/workerpool/src/environment.js","node_modules/workerpool/dist/webpack:/workerpool/src/generated/embeddedWorker.js","node_modules/workerpool/dist/webpack:/workerpool/src/requireFoolWebpack.js","node_modules/workerpool/dist/webpack:/workerpool/src/worker.js","node_modules/workerpool/dist/webpack:/workerpool/webpack/bootstrap","node_modules/workerpool/dist/webpack:/workerpool/src/index.js","node_modules/process/browser.js","html/sim/sim.ts","html/sim/swipe.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/@parcel/runtime-js/lib/runtime-adde320768490017.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"gcU1a\\\":\\\"index.3c279550.js\\\",\\\"4bfU0\\\":\\\"worker.96f4e23c.js\\\",\\\"kpOvT\\\":\\\"index.d09eef58.js\\\"}\"));","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"workerpool\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"workerpool\"] = factory();\n\telse\n\t\troot[\"workerpool\"] = factory();\n})((typeof self !== 'undefined' ? self : this), function() {\nreturn ","var Promise = require('./Promise');\nvar WorkerHandler = require('./WorkerHandler');\nvar environment = require('./environment');\nvar DebugPortAllocator = require('./debug-port-allocator');\nvar DEBUG_PORT_ALLOCATOR = new DebugPortAllocator();\n/**\n * A pool to manage workers\n * @param {String} [script]   Optional worker script\n * @param {WorkerPoolOptions} [options]  See docs\n * @constructor\n */\nfunction Pool(script, options) {\n  if (typeof script === 'string') {\n    this.script = script || null;\n  }\n  else {\n    this.script = null;\n    options = script;\n  }\n\n  this.workers = [];  // queue with all workers\n  this.tasks = [];    // queue with tasks awaiting execution\n\n  options = options || {};\n\n  this.forkArgs = options.forkArgs || [];\n  this.forkOpts = options.forkOpts || {};\n  this.debugPortStart = (options.debugPortStart || 43210);\n  this.nodeWorker = options.nodeWorker;\n  this.workerType = options.workerType || options.nodeWorker || 'auto'\n  this.maxQueueSize = options.maxQueueSize || Infinity;\n\n  // configuration\n  if (options && 'maxWorkers' in options) {\n    validateMaxWorkers(options.maxWorkers);\n    this.maxWorkers = options.maxWorkers;\n  }\n  else {\n    this.maxWorkers = Math.max((environment.cpus || 4) - 1, 1);\n  }\n\n  if (options && 'minWorkers' in options) {\n    if(options.minWorkers === 'max') {\n      this.minWorkers = this.maxWorkers;\n    } else {\n      validateMinWorkers(options.minWorkers);\n      this.minWorkers = options.minWorkers;\n      this.maxWorkers = Math.max(this.minWorkers, this.maxWorkers);     // in case minWorkers is higher than maxWorkers\n    }\n    this._ensureMinWorkers();\n  }\n\n  this._boundNext = this._next.bind(this);\n\n\n  if (this.workerType === 'thread') {\n    WorkerHandler.ensureWorkerThreads();\n  }\n}\n\n\n/**\n * Execute a function on a worker.\n *\n * Example usage:\n *\n *   var pool = new Pool()\n *\n *   // call a function available on the worker\n *   pool.exec('fibonacci', [6])\n *\n *   // offload a function\n *   function add(a, b) {\n *     return a + b\n *   };\n *   pool.exec(add, [2, 4])\n *       .then(function (result) {\n *         console.log(result); // outputs 6\n *       })\n *       .catch(function(error) {\n *         console.log(error);\n *       });\n *\n * @param {String | Function} method  Function name or function.\n *                                    If `method` is a string, the corresponding\n *                                    method on the worker will be executed\n *                                    If `method` is a Function, the function\n *                                    will be stringified and executed via the\n *                                    workers built-in function `run(fn, args)`.\n * @param {Array} [params]  Function arguments applied when calling the function\n * @param {ExecOptions} [options]  Options object\n * @return {Promise.<*, Error>} result\n */\nPool.prototype.exec = function (method, params, options) {\n  // validate type of arguments\n  if (params && !Array.isArray(params)) {\n    throw new TypeError('Array expected as argument \"params\"');\n  }\n\n  if (typeof method === 'string') {\n    var resolver = Promise.defer();\n\n    if (this.tasks.length >= this.maxQueueSize) {\n      throw new Error('Max queue size of ' + this.maxQueueSize + ' reached');\n    }\n\n    // add a new task to the queue\n    var tasks = this.tasks;\n    var task = {\n      method:  method,\n      params:  params,\n      resolver: resolver,\n      timeout: null,\n      options: options\n    };\n    tasks.push(task);\n\n    // replace the timeout method of the Promise with our own,\n    // which starts the timer as soon as the task is actually started\n    var originalTimeout = resolver.promise.timeout;\n    resolver.promise.timeout = function timeout (delay) {\n      if (tasks.indexOf(task) !== -1) {\n        // task is still queued -> start the timer later on\n        task.timeout = delay;\n        return resolver.promise;\n      }\n      else {\n        // task is already being executed -> start timer immediately\n        return originalTimeout.call(resolver.promise, delay);\n      }\n    };\n\n    // trigger task execution\n    this._next();\n\n    return resolver.promise;\n  }\n  else if (typeof method === 'function') {\n    // send stringified function and function arguments to worker\n    return this.exec('run', [String(method), params]);\n  }\n  else {\n    throw new TypeError('Function or string expected as argument \"method\"');\n  }\n};\n\n/**\n * Create a proxy for current worker. Returns an object containing all\n * methods available on the worker. The methods always return a promise.\n *\n * @return {Promise.<Object, Error>} proxy\n */\nPool.prototype.proxy = function () {\n  if (arguments.length > 0) {\n    throw new Error('No arguments expected');\n  }\n\n  var pool = this;\n  return this.exec('methods')\n      .then(function (methods) {\n        var proxy = {};\n\n        methods.forEach(function (method) {\n          proxy[method] = function () {\n            return pool.exec(method, Array.prototype.slice.call(arguments));\n          }\n        });\n\n        return proxy;\n      });\n};\n\n/**\n * Creates new array with the results of calling a provided callback function\n * on every element in this array.\n * @param {Array} array\n * @param {function} callback  Function taking two arguments:\n *                             `callback(currentValue, index)`\n * @return {Promise.<Array>} Returns a promise which resolves  with an Array\n *                           containing the results of the callback function\n *                           executed for each of the array elements.\n */\n/* TODO: implement map\nPool.prototype.map = function (array, callback) {\n};\n*/\n\n/**\n * Grab the first task from the queue, find a free worker, and assign the\n * worker to the task.\n * @protected\n */\nPool.prototype._next = function () {\n  if (this.tasks.length > 0) {\n    // there are tasks in the queue\n\n    // find an available worker\n    var worker = this._getWorker();\n    if (worker) {\n      // get the first task from the queue\n      var me = this;\n      var task = this.tasks.shift();\n\n      // check if the task is still pending (and not cancelled -> promise rejected)\n      if (task.resolver.promise.pending) {\n        // send the request to the worker\n        var promise = worker.exec(task.method, task.params, task.resolver, task.options)\n          .then(me._boundNext)\n          .catch(function () {\n            // if the worker crashed and terminated, remove it from the pool\n            if (worker.terminated) {\n              return me._removeWorker(worker);\n            }\n          }).then(function() {\n            me._next(); // trigger next task in the queue\n          });\n\n        // start queued timer now\n        if (typeof task.timeout === 'number') {\n          promise.timeout(task.timeout);\n        }\n      } else {\n        // The task taken was already complete (either rejected or resolved), so just trigger next task in the queue\n        me._next();\n      }\n    }\n  }\n};\n\n/**\n * Get an available worker. If no worker is available and the maximum number\n * of workers isn't yet reached, a new worker will be created and returned.\n * If no worker is available and the maximum number of workers is reached,\n * null will be returned.\n *\n * @return {WorkerHandler | null} worker\n * @private\n */\nPool.prototype._getWorker = function() {\n  // find a non-busy worker\n  var workers = this.workers;\n  for (var i = 0; i < workers.length; i++) {\n    var worker = workers[i];\n    if (worker.busy() === false) {\n      return worker;\n    }\n  }\n\n  if (workers.length < this.maxWorkers) {\n    // create a new worker\n    worker = this._createWorkerHandler();\n    workers.push(worker);\n    return worker;\n  }\n\n  return null;\n};\n\n/**\n * Remove a worker from the pool.\n * Attempts to terminate worker if not already terminated, and ensures the minimum\n * pool size is met.\n * @param {WorkerHandler} worker\n * @return {Promise<WorkerHandler>}\n * @protected\n */\nPool.prototype._removeWorker = function(worker) {\n  DEBUG_PORT_ALLOCATOR.releasePort(worker.debugPort);\n  // _removeWorker will call this, but we need it to be removed synchronously\n  this._removeWorkerFromList(worker);\n  // If minWorkers set, spin up new workers to replace the crashed ones\n  this._ensureMinWorkers();\n  // terminate the worker (if not already terminated)\n  return new Promise(function(resolve, reject) {\n    worker.terminate(false, function(err) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(worker);\n      }\n    });\n  });\n};\n\n/**\n * Remove a worker from the pool list.\n * @param {WorkerHandler} worker\n * @protected\n */\nPool.prototype._removeWorkerFromList = function(worker) {\n  // remove from the list with workers\n  var index = this.workers.indexOf(worker);\n  if (index !== -1) {\n    this.workers.splice(index, 1);\n  }\n};\n\n/**\n * Close all active workers. Tasks currently being executed will be finished first.\n * @param {boolean} [force=false]   If false (default), the workers are terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the workers will be\n *                                  terminated immediately.\n * @param {number} [timeout]        If provided and non-zero, worker termination promise will be rejected\n *                                  after timeout if worker process has not been terminated.\n * @return {Promise.<void, Error>}\n */\nPool.prototype.terminate = function (force, timeout) {\n  // cancel any pending tasks\n  this.tasks.forEach(function (task) {\n    task.resolver.reject(new Error('Pool terminated'));\n  });\n  this.tasks.length = 0;\n\n  var f = function (worker) {\n    this._removeWorkerFromList(worker);\n  };\n  var removeWorker = f.bind(this);\n\n  var promises = [];\n  var workers = this.workers.slice();\n  workers.forEach(function (worker) {\n    var termPromise = worker.terminateAndNotify(force, timeout)\n      .then(removeWorker);\n    promises.push(termPromise);\n  });\n  return Promise.all(promises);\n};\n\n/**\n * Retrieve statistics on tasks and workers.\n * @return {{totalWorkers: number, busyWorkers: number, idleWorkers: number, pendingTasks: number, activeTasks: number}} Returns an object with statistics\n */\nPool.prototype.stats = function () {\n  var totalWorkers = this.workers.length;\n  var busyWorkers = this.workers.filter(function (worker) {\n    return worker.busy();\n  }).length;\n\n  return {\n    totalWorkers:  totalWorkers,\n    busyWorkers:   busyWorkers,\n    idleWorkers:   totalWorkers - busyWorkers,\n\n    pendingTasks:  this.tasks.length,\n    activeTasks:   busyWorkers\n  };\n};\n\n/**\n * Ensures that a minimum of minWorkers is up and running\n * @protected\n */\nPool.prototype._ensureMinWorkers = function() {\n  if (this.minWorkers) {\n    for(var i = this.workers.length; i < this.minWorkers; i++) {\n      this.workers.push(this._createWorkerHandler());\n    }\n  }\n};\n\n/**\n * Helper function to create a new WorkerHandler and pass all options.\n * @return {WorkerHandler}\n * @private\n */\nPool.prototype._createWorkerHandler = function () {\n  return new WorkerHandler(this.script, {\n    forkArgs: this.forkArgs,\n    forkOpts: this.forkOpts,\n    debugPort: DEBUG_PORT_ALLOCATOR.nextAvailableStartingAt(this.debugPortStart),\n    workerType: this.workerType\n  });\n}\n\n/**\n * Ensure that the maxWorkers option is an integer >= 1\n * @param {*} maxWorkers\n * @returns {boolean} returns true maxWorkers has a valid value\n */\nfunction validateMaxWorkers(maxWorkers) {\n  if (!isNumber(maxWorkers) || !isInteger(maxWorkers) || maxWorkers < 1) {\n    throw new TypeError('Option maxWorkers must be an integer number >= 1');\n  }\n}\n\n/**\n * Ensure that the minWorkers option is an integer >= 0\n * @param {*} minWorkers\n * @returns {boolean} returns true when minWorkers has a valid value\n */\nfunction validateMinWorkers(minWorkers) {\n  if (!isNumber(minWorkers) || !isInteger(minWorkers) || minWorkers < 0) {\n    throw new TypeError('Option minWorkers must be an integer number >= 0');\n  }\n}\n\n/**\n * Test whether a variable is a number\n * @param {*} value\n * @returns {boolean} returns true when value is a number\n */\nfunction isNumber(value) {\n  return typeof value === 'number';\n}\n\n/**\n * Test whether a number is an integer\n * @param {number} value\n * @returns {boolean} Returns true if value is an integer\n */\nfunction isInteger(value) {\n  return Math.round(value) == value;\n}\n\nmodule.exports = Pool;\n","'use strict';\n\n/**\n * Promise\n *\n * Inspired by https://gist.github.com/RubaXa/8501359 from RubaXa <trash@rubaxa.org>\n *\n * @param {Function} handler   Called as handler(resolve: Function, reject: Function)\n * @param {Promise} [parent]   Parent promise for propagation of cancel and timeout\n */\nfunction Promise(handler, parent) {\n  var me = this;\n\n  if (!(this instanceof Promise)) {\n    throw new SyntaxError('Constructor must be called with the new operator');\n  }\n\n  if (typeof handler !== 'function') {\n    throw new SyntaxError('Function parameter handler(resolve, reject) missing');\n  }\n\n  var _onSuccess = [];\n  var _onFail = [];\n\n  // status\n  this.resolved = false;\n  this.rejected = false;\n  this.pending = true;\n\n  /**\n   * Process onSuccess and onFail callbacks: add them to the queue.\n   * Once the promise is resolve, the function _promise is replace.\n   * @param {Function} onSuccess\n   * @param {Function} onFail\n   * @private\n   */\n  var _process = function (onSuccess, onFail) {\n    _onSuccess.push(onSuccess);\n    _onFail.push(onFail);\n  };\n\n  /**\n   * Add an onSuccess callback and optionally an onFail callback to the Promise\n   * @param {Function} onSuccess\n   * @param {Function} [onFail]\n   * @returns {Promise} promise\n   */\n  this.then = function (onSuccess, onFail) {\n    return new Promise(function (resolve, reject) {\n      var s = onSuccess ? _then(onSuccess, resolve, reject) : resolve;\n      var f = onFail    ? _then(onFail,    resolve, reject) : reject;\n\n      _process(s, f);\n    }, me);\n  };\n\n  /**\n   * Resolve the promise\n   * @param {*} result\n   * @type {Function}\n   */\n  var _resolve = function (result) {\n    // update status\n    me.resolved = true;\n    me.rejected = false;\n    me.pending = false;\n\n    _onSuccess.forEach(function (fn) {\n      fn(result);\n    });\n\n    _process = function (onSuccess, onFail) {\n      onSuccess(result);\n    };\n\n    _resolve = _reject = function () { };\n\n    return me;\n  };\n\n  /**\n   * Reject the promise\n   * @param {Error} error\n   * @type {Function}\n   */\n  var _reject = function (error) {\n    // update status\n    me.resolved = false;\n    me.rejected = true;\n    me.pending = false;\n\n    _onFail.forEach(function (fn) {\n      fn(error);\n    });\n\n    _process = function (onSuccess, onFail) {\n      onFail(error);\n    };\n\n    _resolve = _reject = function () { }\n\n    return me;\n  };\n\n  /**\n   * Cancel te promise. This will reject the promise with a CancellationError\n   * @returns {Promise} self\n   */\n  this.cancel = function () {\n    if (parent) {\n      parent.cancel();\n    }\n    else {\n      _reject(new CancellationError());\n    }\n\n    return me;\n  };\n\n  /**\n   * Set a timeout for the promise. If the promise is not resolved within\n   * the time, the promise will be cancelled and a TimeoutError is thrown.\n   * If the promise is resolved in time, the timeout is removed.\n   * @param {number} delay     Delay in milliseconds\n   * @returns {Promise} self\n   */\n  this.timeout = function (delay) {\n    if (parent) {\n      parent.timeout(delay);\n    }\n    else {\n      var timer = setTimeout(function () {\n        _reject(new TimeoutError('Promise timed out after ' + delay + ' ms'));\n      }, delay);\n\n      me.always(function () {\n        clearTimeout(timer);\n      });\n    }\n\n    return me;\n  };\n\n  // attach handler passing the resolve and reject functions\n  handler(function (result) {\n    _resolve(result);\n  }, function (error) {\n    _reject(error);\n  });\n}\n\n/**\n * Execute given callback, then call resolve/reject based on the returned result\n * @param {Function} callback\n * @param {Function} resolve\n * @param {Function} reject\n * @returns {Function}\n * @private\n */\nfunction _then(callback, resolve, reject) {\n  return function (result) {\n    try {\n      var res = callback(result);\n      if (res && typeof res.then === 'function' && typeof res['catch'] === 'function') {\n        // method returned a promise\n        res.then(resolve, reject);\n      }\n      else {\n        resolve(res);\n      }\n    }\n    catch (error) {\n      reject(error);\n    }\n  }\n}\n\n/**\n * Add an onFail callback to the Promise\n * @param {Function} onFail\n * @returns {Promise} promise\n */\nPromise.prototype['catch'] = function (onFail) {\n  return this.then(null, onFail);\n};\n\n// TODO: add support for Promise.catch(Error, callback)\n// TODO: add support for Promise.catch(Error, Error, callback)\n\n/**\n * Execute given callback when the promise either resolves or rejects.\n * @param {Function} fn\n * @returns {Promise} promise\n */\nPromise.prototype.always = function (fn) {\n  return this.then(fn, fn);\n};\n\n/**\n * Create a promise which resolves when all provided promises are resolved,\n * and fails when any of the promises resolves.\n * @param {Promise[]} promises\n * @returns {Promise} promise\n */\nPromise.all = function (promises){\n  return new Promise(function (resolve, reject) {\n    var remaining = promises.length,\n        results = [];\n\n    if (remaining) {\n      promises.forEach(function (p, i) {\n        p.then(function (result) {\n          results[i] = result;\n          remaining--;\n          if (remaining == 0) {\n            resolve(results);\n          }\n        }, function (error) {\n          remaining = 0;\n          reject(error);\n        });\n      });\n    }\n    else {\n      resolve(results);\n    }\n  });\n};\n\n/**\n * Create a promise resolver\n * @returns {{promise: Promise, resolve: Function, reject: Function}} resolver\n */\nPromise.defer = function () {\n  var resolver = {};\n\n  resolver.promise = new Promise(function (resolve, reject) {\n    resolver.resolve = resolve;\n    resolver.reject = reject;\n  });\n\n  return resolver;\n};\n\n/**\n * Create a cancellation error\n * @param {String} [message]\n * @extends Error\n */\nfunction CancellationError(message) {\n  this.message = message || 'promise cancelled';\n  this.stack = (new Error()).stack;\n}\n\nCancellationError.prototype = new Error();\nCancellationError.prototype.constructor = Error;\nCancellationError.prototype.name = 'CancellationError';\n\nPromise.CancellationError = CancellationError;\n\n\n/**\n * Create a timeout error\n * @param {String} [message]\n * @extends Error\n */\nfunction TimeoutError(message) {\n  this.message = message || 'timeout exceeded';\n  this.stack = (new Error()).stack;\n}\n\nTimeoutError.prototype = new Error();\nTimeoutError.prototype.constructor = Error;\nTimeoutError.prototype.name = 'TimeoutError';\n\nPromise.TimeoutError = TimeoutError;\n\n\nmodule.exports = Promise;\n","'use strict';\n\nvar Promise = require('./Promise');\nvar environment = require('./environment');\nvar requireFoolWebpack = require('./requireFoolWebpack');\n\n/**\n * Special message sent by parent which causes a child process worker to terminate itself.\n * Not a \"message object\"; this string is the entire message.\n */\nvar TERMINATE_METHOD_ID = '__workerpool-terminate__';\n\n/**\n * If sending `TERMINATE_METHOD_ID` does not cause the child process to exit in this many milliseconds,\n * force-kill the child process.\n */\nvar CHILD_PROCESS_EXIT_TIMEOUT = 1000;\n\nfunction ensureWorkerThreads() {\n  var WorkerThreads = tryRequireWorkerThreads()\n  if (!WorkerThreads) {\n    throw new Error('WorkerPool: workerType = \\'thread\\' is not supported, Node >= 11.7.0 required')\n  }\n\n  return WorkerThreads;\n}\n\n// check whether Worker is supported by the browser\nfunction ensureWebWorker() {\n  // Workaround for a bug in PhantomJS (Or QtWebkit): https://github.com/ariya/phantomjs/issues/14534\n  if (typeof Worker !== 'function' && (typeof Worker !== 'object' || typeof Worker.prototype.constructor !== 'function')) {\n    throw new Error('WorkerPool: Web Workers not supported');\n  }\n}\n\nfunction tryRequireWorkerThreads() {\n  try {\n    return requireFoolWebpack('worker_threads');\n  } catch(error) {\n    if (typeof error === 'object' && error !== null && error.code === 'MODULE_NOT_FOUND') {\n      // no worker_threads available (old version of node.js)\n      return null;\n    } else {\n      throw error;\n    }\n  }\n}\n\n// get the default worker script\nfunction getDefaultWorker() {\n  if (environment.platform === 'browser') {\n    // test whether the browser supports all features that we need\n    if (typeof Blob === 'undefined') {\n      throw new Error('Blob not supported by the browser');\n    }\n    if (!window.URL || typeof window.URL.createObjectURL !== 'function') {\n      throw new Error('URL.createObjectURL not supported by the browser');\n    }\n\n    // use embedded worker.js\n    var blob = new Blob([require('./generated/embeddedWorker')], {type: 'text/javascript'});\n    return window.URL.createObjectURL(blob);\n  }\n  else {\n    // use external worker.js in current directory\n    return __dirname + '/worker.js';\n  }\n}\n\nfunction setupWorker(script, options) {\n  if (options.workerType === 'web') { // browser only\n    ensureWebWorker();\n    return setupBrowserWorker(script, Worker);\n  } else if (options.workerType === 'thread') { // node.js only\n    WorkerThreads = ensureWorkerThreads();\n    return setupWorkerThreadWorker(script, WorkerThreads);\n  } else if (options.workerType === 'process' || !options.workerType) { // node.js only\n    return setupProcessWorker(script, resolveForkOptions(options), requireFoolWebpack('child_process'));\n  } else { // options.workerType === 'auto' or undefined\n    if (environment.platform === 'browser') {\n      ensureWebWorker();\n      return setupBrowserWorker(script, Worker);\n    }\n    else { // environment.platform === 'node'\n      var WorkerThreads = tryRequireWorkerThreads();\n      if (WorkerThreads) {\n        return setupWorkerThreadWorker(script, WorkerThreads);\n      } else {\n        return setupProcessWorker(script, resolveForkOptions(options), requireFoolWebpack('child_process'));\n      }\n    }\n  }\n}\n\nfunction setupBrowserWorker(script, Worker) {\n  // create the web worker\n  var worker = new Worker(script);\n\n  worker.isBrowserWorker = true;\n  // add node.js API to the web worker\n  worker.on = function (event, callback) {\n    this.addEventListener(event, function (message) {\n      callback(message.data);\n    });\n  };\n  worker.send = function (message) {\n    this.postMessage(message);\n  };\n  return worker;\n}\n\nfunction setupWorkerThreadWorker(script, WorkerThreads) {\n  var worker = new WorkerThreads.Worker(script, {\n    stdout: false, // automatically pipe worker.STDOUT to process.STDOUT\n    stderr: false  // automatically pipe worker.STDERR to process.STDERR\n  });\n  worker.isWorkerThread = true;\n  // make the worker mimic a child_process\n  worker.send = function(message) {\n    this.postMessage(message);\n  };\n\n  worker.kill = function() {\n    this.terminate();\n    return true;\n  };\n\n  worker.disconnect = function() {\n    this.terminate();\n  };\n\n  return worker;\n}\n\nfunction setupProcessWorker(script, options, child_process) {\n  // no WorkerThreads, fallback to sub-process based workers\n  var worker = child_process.fork(\n    script,\n    options.forkArgs,\n    options.forkOpts\n  );\n\n  worker.isChildProcess = true;\n  return worker;\n}\n\n// add debug flags to child processes if the node inspector is active\nfunction resolveForkOptions(opts) {\n  opts = opts || {};\n\n  var processExecArgv = process.execArgv.join(' ');\n  var inspectorActive = processExecArgv.indexOf('--inspect') !== -1;\n  var debugBrk = processExecArgv.indexOf('--debug-brk') !== -1;\n\n  var execArgv = [];\n  if (inspectorActive) {\n    execArgv.push('--inspect=' + opts.debugPort);\n\n    if (debugBrk) {\n      execArgv.push('--debug-brk');\n    }\n  }\n\n  process.execArgv.forEach(function(arg) {\n    if (arg.indexOf('--max-old-space-size') > -1) {\n      execArgv.push(arg)\n    }\n  })\n\n  return Object.assign({}, opts, {\n    forkArgs: opts.forkArgs,\n    forkOpts: Object.assign({}, opts.forkOpts, {\n      execArgv: (opts.forkOpts && opts.forkOpts.execArgv || [])\n      .concat(execArgv)\n    })\n  });\n}\n\n/**\n * Converts a serialized error to Error\n * @param {Object} obj Error that has been serialized and parsed to object\n * @return {Error} The equivalent Error.\n */\nfunction objectToError (obj) {\n  var temp = new Error('')\n  var props = Object.keys(obj)\n\n  for (var i = 0; i < props.length; i++) {\n    temp[props[i]] = obj[props[i]]\n  }\n\n  return temp\n}\n\n/**\n * A WorkerHandler controls a single worker. This worker can be a child process\n * on node.js or a WebWorker in a browser environment.\n * @param {String} [script] If no script is provided, a default worker with a\n *                          function run will be created.\n * @param {WorkerPoolOptions} _options See docs\n * @constructor\n */\nfunction WorkerHandler(script, _options) {\n  var me = this;\n  var options = _options || {};\n\n  this.script = script || getDefaultWorker();\n  this.worker = setupWorker(this.script, options);\n  this.debugPort = options.debugPort;\n\n  // The ready message is only sent if the worker.add method is called (And the default script is not used)\n  if (!script) {\n    this.worker.ready = true;\n  }\n\n  // queue for requests that are received before the worker is ready\n  this.requestQueue = [];\n  this.worker.on('message', function (response) {\n    if (me.terminated) {\n      return;\n    }\n    if (typeof response === 'string' && response === 'ready') {\n      me.worker.ready = true;\n      dispatchQueuedRequests();\n    } else {\n      // find the task from the processing queue, and run the tasks callback\n      var id = response.id;\n      var task = me.processing[id];\n      if (task !== undefined) {\n        if (response.isEvent) {\n          if (task.options && typeof task.options.on === 'function') {\n            task.options.on(response.payload);\n          }\n        } else {\n          // remove the task from the queue\n          delete me.processing[id];\n\n          // test if we need to terminate\n          if (me.terminating === true) {\n            // complete worker termination if all tasks are finished\n            me.terminate();\n          }\n\n          // resolve the task's promise\n          if (response.error) {\n            task.resolver.reject(objectToError(response.error));\n          }\n          else {\n            task.resolver.resolve(response.result);\n          }\n        }\n      }\n    }\n  });\n\n  // reject all running tasks on worker error\n  function onError(error) {\n    me.terminated = true;\n\n    for (var id in me.processing) {\n      if (me.processing[id] !== undefined) {\n        me.processing[id].resolver.reject(error);\n      }\n    }\n    me.processing = Object.create(null);\n  }\n\n  // send all queued requests to worker\n  function dispatchQueuedRequests()\n  {\n    for(const request of me.requestQueue.splice(0)) {\n      me.worker.send(request);\n    }\n  }\n\n  var worker = this.worker;\n  // listen for worker messages error and exit\n  this.worker.on('error', onError);\n  this.worker.on('exit', function (exitCode, signalCode) {\n    var message = 'Workerpool Worker terminated Unexpectedly\\n';\n\n    message += '    exitCode: `' + exitCode + '`\\n';\n    message += '    signalCode: `' + signalCode + '`\\n';\n\n    message += '    workerpool.script: `' +  me.script + '`\\n';\n    message += '    spawnArgs: `' +  worker.spawnargs + '`\\n';\n    message += '    spawnfile: `' + worker.spawnfile + '`\\n'\n\n    message += '    stdout: `' + worker.stdout + '`\\n'\n    message += '    stderr: `' + worker.stderr + '`\\n'\n\n    onError(new Error(message));\n  });\n\n  this.processing = Object.create(null); // queue with tasks currently in progress\n\n  this.terminating = false;\n  this.terminated = false;\n  this.terminationHandler = null;\n  this.lastId = 0;\n}\n\n/**\n * Get a list with methods available on the worker.\n * @return {Promise.<String[], Error>} methods\n */\nWorkerHandler.prototype.methods = function () {\n  return this.exec('methods');\n};\n\n/**\n * Execute a method with given parameters on the worker\n * @param {String} method\n * @param {Array} [params]\n * @param {{resolve: Function, reject: Function}} [resolver]\n * @param {ExecOptions}  [options]\n * @return {Promise.<*, Error>} result\n */\nWorkerHandler.prototype.exec = function(method, params, resolver, options) {\n  if (!resolver) {\n    resolver = Promise.defer();\n  }\n\n  // generate a unique id for the task\n  var id = ++this.lastId;\n\n  // register a new task as being in progress\n  this.processing[id] = {\n    id: id,\n    resolver: resolver,\n    options: options\n  };\n\n  // build a JSON-RPC request\n  var request = {\n    id: id,\n    method: method,\n    params: params\n  };\n\n  if (this.terminated) {\n    resolver.reject(new Error('Worker is terminated'));\n  } else if (this.worker.ready) {\n    // send the request to the worker\n    this.worker.send(request);\n  } else {\n    this.requestQueue.push(request);\n  }\n\n  // on cancellation, force the worker to terminate\n  var me = this;\n  return resolver.promise.catch(function (error) {\n    if (error instanceof Promise.CancellationError || error instanceof Promise.TimeoutError) {\n      // remove this task from the queue. It is already rejected (hence this\n      // catch event), and else it will be rejected again when terminating\n      delete me.processing[id];\n\n      // terminate worker\n      return me.terminateAndNotify(true)\n        .then(function() {\n          throw error;\n        }, function(err) {\n          throw err;\n        });\n    } else {\n      throw error;\n    }\n  })\n};\n\n/**\n * Test whether the worker is working or not\n * @return {boolean} Returns true if the worker is busy\n */\nWorkerHandler.prototype.busy = function () {\n  return Object.keys(this.processing).length > 0;\n};\n\n/**\n * Terminate the worker.\n * @param {boolean} [force=false]   If false (default), the worker is terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the worker will be\n *                                  terminated immediately.\n * @param {function} [callback=null] If provided, will be called when process terminates.\n */\nWorkerHandler.prototype.terminate = function (force, callback) {\n  var me = this;\n  if (force) {\n    // cancel all tasks in progress\n    for (var id in this.processing) {\n      if (this.processing[id] !== undefined) {\n        this.processing[id].resolver.reject(new Error('Worker terminated'));\n      }\n    }\n    this.processing = Object.create(null);\n  }\n\n  if (typeof callback === 'function') {\n    this.terminationHandler = callback;\n  }\n  if (!this.busy()) {\n    // all tasks are finished. kill the worker\n    var cleanup = function(err) {\n      me.terminated = true;\n      if (me.worker != null && me.worker.removeAllListeners) {\n        // removeAllListeners is only available for child_process\n        me.worker.removeAllListeners('message');\n      }\n      me.worker = null;\n      me.terminating = false;\n      if (me.terminationHandler) {\n        me.terminationHandler(err, me);\n      } else if (err) {\n        throw err;\n      }\n    }\n\n    if (this.worker) {\n      if (typeof this.worker.kill === 'function') {\n        if (this.worker.killed) {\n          cleanup(new Error('worker already killed!'));\n          return;\n        }\n\n        if (this.worker.isChildProcess) {\n          var cleanExitTimeout = setTimeout(function() {\n            me.worker.kill();\n          }, CHILD_PROCESS_EXIT_TIMEOUT);\n\n          this.worker.once('exit', function() {\n            clearTimeout(cleanExitTimeout);\n            me.worker.killed = true;\n            cleanup();\n          });\n\n          if (this.worker.ready) {\n            this.worker.send(TERMINATE_METHOD_ID);\n          } else {\n            this.worker.requestQueue.push(TERMINATE_METHOD_ID)\n          }\n        } else {\n          // worker_thread\n          this.worker.kill();\n          this.worker.killed = true;\n          cleanup();\n        }\n        return;\n      }\n      else if (typeof this.worker.terminate === 'function') {\n        this.worker.terminate(); // web worker\n        this.worker.killed = true;\n      }\n      else {\n        throw new Error('Failed to terminate worker');\n      }\n    }\n    cleanup();\n  }\n  else {\n    // we can't terminate immediately, there are still tasks being executed\n    this.terminating = true;\n  }\n};\n\n/**\n * Terminate the worker, returning a Promise that resolves when the termination has been done.\n * @param {boolean} [force=false]   If false (default), the worker is terminated\n *                                  after finishing all tasks currently in\n *                                  progress. If true, the worker will be\n *                                  terminated immediately.\n * @param {number} [timeout]        If provided and non-zero, worker termination promise will be rejected\n *                                  after timeout if worker process has not been terminated.\n * @return {Promise.<WorkerHandler, Error>}\n */\nWorkerHandler.prototype.terminateAndNotify = function (force, timeout) {\n  var resolver = Promise.defer();\n  if (timeout) {\n    resolver.promise.timeout = timeout;\n  }\n  this.terminate(force, function(err, worker) {\n    if (err) {\n      resolver.reject(err);\n    } else {\n      resolver.resolve(worker);\n    }\n  });\n  return resolver.promise;\n};\n\nmodule.exports = WorkerHandler;\nmodule.exports._tryRequireWorkerThreads = tryRequireWorkerThreads;\nmodule.exports._setupProcessWorker = setupProcessWorker;\nmodule.exports._setupBrowserWorker = setupBrowserWorker;\nmodule.exports._setupWorkerThreadWorker = setupWorkerThreadWorker;\nmodule.exports.ensureWorkerThreads = ensureWorkerThreads;\n","'use strict';\n\nvar MAX_PORTS = 65535;\nmodule.exports = DebugPortAllocator;\nfunction DebugPortAllocator() {\n  this.ports = Object.create(null);\n  this.length = 0;\n}\n\nDebugPortAllocator.prototype.nextAvailableStartingAt = function(starting) {\n  while (this.ports[starting] === true) {\n    starting++;\n  }\n\n  if (starting >= MAX_PORTS) {\n    throw new Error('WorkerPool debug port limit reached: ' + starting + '>= ' + MAX_PORTS );\n  }\n\n  this.ports[starting] = true;\n  this.length++;\n  return starting;\n};\n\nDebugPortAllocator.prototype.releasePort = function(port) {\n  delete this.ports[port];\n  this.length--;\n};\n\n","var requireFoolWebpack = require('./requireFoolWebpack');\n\n// source: https://github.com/flexdinesh/browser-or-node\nvar isNode = function (nodeProcess) {\n  return (\n    typeof nodeProcess !== 'undefined' &&\n    nodeProcess.versions != null &&\n    nodeProcess.versions.node != null\n  );\n}\nmodule.exports.isNode = isNode\n\n// determines the JavaScript platform: browser or node\nmodule.exports.platform = typeof process !== 'undefined' && isNode(process)\n  ? 'node'\n  : 'browser';\n\n// determines whether the code is running in main thread or not\n// note that in node.js we have to check both worker_thread and child_process\nvar worker_threads = tryRequireFoolWebpack('worker_threads');\nmodule.exports.isMainThread = module.exports.platform === 'node'\n  ? ((!worker_threads || worker_threads.isMainThread) && !process.connected)\n  : typeof Window !== 'undefined';\n\n// determines the number of cpus available\nmodule.exports.cpus = module.exports.platform === 'browser'\n  ? self.navigator.hardwareConcurrency\n  : requireFoolWebpack('os').cpus().length;\n\nfunction tryRequireFoolWebpack (module) {\n  try {\n    return requireFoolWebpack(module);\n  } catch(err) {\n    return null\n  }\n}\n","/**\n * embeddedWorker.js contains an embedded version of worker.js.\n * This file is automatically generated,\n * changes made in this file will be overwritten.\n */\nmodule.exports = \"!function(){var __webpack_exports__={};!function(){var exports=__webpack_exports__,__webpack_unused_export__;function _typeof(r){return(_typeof=\\\"function\\\"==typeof Symbol&&\\\"symbol\\\"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&\\\"function\\\"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?\\\"symbol\\\":typeof r})(r)}var requireFoolWebpack=eval(\\\"typeof require !== 'undefined' ? require : function (module) { throw new Error('Module \\\\\\\" + module + \\\\\\\" not found.') }\\\"),TERMINATE_METHOD_ID=\\\"__workerpool-terminate__\\\",worker={exit:function(){}},WorkerThreads,parentPort;if(\\\"undefined\\\"!=typeof self&&\\\"function\\\"==typeof postMessage&&\\\"function\\\"==typeof addEventListener)worker.on=function(r,e){addEventListener(r,function(r){e(r.data)})},worker.send=function(r){postMessage(r)};else{if(\\\"undefined\\\"==typeof process)throw new Error(\\\"Script must be executed as a worker\\\");try{WorkerThreads=requireFoolWebpack(\\\"worker_threads\\\")}catch(error){if(\\\"object\\\"!==_typeof(error)||null===error||\\\"MODULE_NOT_FOUND\\\"!==error.code)throw error}WorkerThreads&&null!==WorkerThreads.parentPort?(parentPort=WorkerThreads.parentPort,worker.send=parentPort.postMessage.bind(parentPort),worker.on=parentPort.on.bind(parentPort)):(worker.on=process.on.bind(process),worker.send=process.send.bind(process),worker.on(\\\"disconnect\\\",function(){process.exit(1)}),worker.exit=process.exit.bind(process))}function convertError(o){return Object.getOwnPropertyNames(o).reduce(function(r,e){return Object.defineProperty(r,e,{value:o[e],enumerable:!0})},{})}function isPromise(r){return r&&\\\"function\\\"==typeof r.then&&\\\"function\\\"==typeof r.catch}worker.methods={},worker.methods.run=function(r,e){r=new Function(\\\"return (\\\"+r+\\\").apply(null, arguments);\\\");return r.apply(r,e)},worker.methods.methods=function(){return Object.keys(worker.methods)};var currentRequestId=null;worker.on(\\\"message\\\",function(e){if(e===TERMINATE_METHOD_ID)return worker.exit(0);try{var r=worker.methods[e.method];if(!r)throw new Error('Unknown method \\\"'+e.method+'\\\"');currentRequestId=e.id;var o=r.apply(r,e.params);isPromise(o)?o.then(function(r){worker.send({id:e.id,result:r,error:null}),currentRequestId=null}).catch(function(r){worker.send({id:e.id,result:null,error:convertError(r)}),currentRequestId=null}):(worker.send({id:e.id,result:o,error:null}),currentRequestId=null)}catch(r){worker.send({id:e.id,result:null,error:convertError(r)})}}),worker.register=function(r){if(r)for(var e in r)r.hasOwnProperty(e)&&(worker.methods[e]=r[e]);worker.send(\\\"ready\\\")},worker.emit=function(r){currentRequestId&&worker.send({id:currentRequestId,isEvent:!0,payload:r})},__webpack_unused_export__=worker.register,__webpack_unused_export__=worker.emit}()}();\";\n","// source of inspiration: https://github.com/sindresorhus/require-fool-webpack\nvar requireFoolWebpack = eval(\n    'typeof require !== \\'undefined\\' ' +\n    '? require ' +\n    ': function (module) { throw new Error(\\'Module \" + module + \" not found.\\') }'\n);\n\nmodule.exports = requireFoolWebpack;\n","/**\n * worker must be started as a child process or a web worker.\n * It listens for RPC messages from the parent process.\n */\n\n// source of inspiration: https://github.com/sindresorhus/require-fool-webpack\nvar requireFoolWebpack = eval(\n    'typeof require !== \\'undefined\\'' +\n    ' ? require' +\n    ' : function (module) { throw new Error(\\'Module \" + module + \" not found.\\') }'\n);\n\n/**\n * Special message sent by parent which causes the worker to terminate itself.\n * Not a \"message object\"; this string is the entire message.\n */\nvar TERMINATE_METHOD_ID = '__workerpool-terminate__';\n\n// var nodeOSPlatform = require('./environment').nodeOSPlatform;\n\n// create a worker API for sending and receiving messages which works both on\n// node.js and in the browser\nvar worker = {\n  exit: function() {}\n};\nif (typeof self !== 'undefined' && typeof postMessage === 'function' && typeof addEventListener === 'function') {\n  // worker in the browser\n  worker.on = function (event, callback) {\n    addEventListener(event, function (message) {\n      callback(message.data);\n    })\n  };\n  worker.send = function (message) {\n    postMessage(message);\n  };\n}\nelse if (typeof process !== 'undefined') {\n  // node.js\n\n  var WorkerThreads;\n  try {\n    WorkerThreads = requireFoolWebpack('worker_threads');\n  } catch(error) {\n    if (typeof error === 'object' && error !== null && error.code === 'MODULE_NOT_FOUND') {\n      // no worker_threads, fallback to sub-process based workers\n    } else {\n      throw error;\n    }\n  }\n\n  if (WorkerThreads &&\n    /* if there is a parentPort, we are in a WorkerThread */\n    WorkerThreads.parentPort !== null) {\n    var parentPort  = WorkerThreads.parentPort;\n    worker.send = parentPort.postMessage.bind(parentPort);\n    worker.on = parentPort.on.bind(parentPort);\n  } else {\n    worker.on = process.on.bind(process);\n    worker.send = process.send.bind(process);\n    // register disconnect handler only for subprocess worker to exit when parent is killed unexpectedly\n    worker.on('disconnect', function () {\n      process.exit(1);\n    });\n    worker.exit = process.exit.bind(process);\n  }\n}\nelse {\n  throw new Error('Script must be executed as a worker');\n}\n\nfunction convertError(error) {\n  return Object.getOwnPropertyNames(error).reduce(function(product, name) {\n    return Object.defineProperty(product, name, {\n\tvalue: error[name],\n\tenumerable: true\n    });\n  }, {});\n}\n\n/**\n * Test whether a value is a Promise via duck typing.\n * @param {*} value\n * @returns {boolean} Returns true when given value is an object\n *                    having functions `then` and `catch`.\n */\nfunction isPromise(value) {\n  return value && (typeof value.then === 'function') && (typeof value.catch === 'function');\n}\n\n// functions available externally\nworker.methods = {};\n\n/**\n * Execute a function with provided arguments\n * @param {String} fn     Stringified function\n * @param {Array} [args]  Function arguments\n * @returns {*}\n */\nworker.methods.run = function run(fn, args) {\n  var f = new Function('return (' + fn + ').apply(null, arguments);');\n  return f.apply(f, args);\n};\n\n/**\n * Get a list with methods available on this worker\n * @return {String[]} methods\n */\nworker.methods.methods = function methods() {\n  return Object.keys(worker.methods);\n};\n\nvar currentRequestId = null;\n\nworker.on('message', function (request) {\n  if (request === TERMINATE_METHOD_ID) {\n    return worker.exit(0);\n  }\n  try {\n    var method = worker.methods[request.method];\n\n    if (method) {\n      currentRequestId = request.id;\n      \n      // execute the function\n      var result = method.apply(method, request.params);\n\n      if (isPromise(result)) {\n        // promise returned, resolve this and then return\n        result\n            .then(function (result) {\n              worker.send({\n                id: request.id,\n                result: result,\n                error: null\n              });\n              currentRequestId = null;\n            })\n            .catch(function (err) {\n              worker.send({\n                id: request.id,\n                result: null,\n                error: convertError(err)\n              });\n              currentRequestId = null;\n            });\n      }\n      else {\n        // immediate result\n        worker.send({\n          id: request.id,\n          result: result,\n          error: null\n        });\n\n        currentRequestId = null;\n      }\n    }\n    else {\n      throw new Error('Unknown method \"' + request.method + '\"');\n    }\n  }\n  catch (err) {\n    worker.send({\n      id: request.id,\n      result: null,\n      error: convertError(err)\n    });\n  }\n});\n\n/**\n * Register methods to the worker\n * @param {Object} methods\n */\nworker.register = function (methods) {\n\n  if (methods) {\n    for (var name in methods) {\n      if (methods.hasOwnProperty(name)) {\n        worker.methods[name] = methods[name];\n      }\n    }\n  }\n\n  worker.send('ready');\n\n};\n\nworker.emit = function (payload) {\n  if (currentRequestId) {\n    worker.send({\n      id: currentRequestId,\n      isEvent: true,\n      payload\n    });\n  }\n};\n\nif (typeof exports !== 'undefined') {\n  exports.add = worker.register;\n  exports.emit = worker.emit;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","var environment = require('./environment');\n\n/**\n * Create a new worker pool\n * @param {string} [script]\n * @param {WorkerPoolOptions} [options]\n * @returns {Pool} pool\n */\nexports.pool = function pool(script, options) {\n  var Pool = require('./Pool');\n\n  return new Pool(script, options);\n};\n\n/**\n * Create a worker and optionally register a set of methods to the worker.\n * @param {Object} [methods]\n */\nexports.worker = function worker(methods) {\n  var worker = require('./worker');\n  worker.add(methods);\n};\n\n/**\n * Sends an event to the parent worker pool.\n * @param {any} payload \n */\nexports.workerEmit = function workerEmit(payload) {\n  var worker = require('./worker');\n  worker.emit(payload);\n};\n\n/**\n * Create a promise.\n * @type {Promise} promise\n */\nexports.Promise = require('./Promise');\n\nexports.platform = environment.platform;\nexports.isMainThread = environment.isMainThread;\nexports.cpus = environment.cpus;","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import * as workerpool from 'workerpool';\n\nimport {State, Random, ID, Formatter, DeckID, Card, DATA, FieldID, Location, Ids, Option, OPTIONS} from '../../src';\nimport {createElement, renderState, track, makeCard, CMP} from '../common';\n\nimport './swipe';\n\ntype Action = {\n  type: 'play' | 'win' | 'lose';\n} | ActionState & ({\n  type: 'target';\n} | {\n  type: 'search';\n  options: [Location, number][];\n  fallback?: Card;\n});\n\ninterface ActionState {\n  origin: {location: Location; i: number};\n  filter: (location: Location, id: DeckID | FieldID, i: number) => boolean;\n  fn: (location: Location, ...j: number[]) => void;\n  num: number;\n  targets: [Location, number][];\n}\n\ninterface Context {\n  state: State;\n  banished: DeckID[];\n  graveyard: ID[];\n  action: Action;\n}\n\nlet STATE!: {\n  option: Option;\n  num: number;\n  start: State;\n  stack: Context[];\n  index: number;\n};\n\nconst BLUE_EYES = {\n  name: 'Blue-Eyes White Dragon',\n  type: 'Monster',\n  attribute: 'Light',\n  level: 8,\n  atk: 3000,\n  def: 2500,\n  text: '<i>Dragon  This legendary dragon is a powerful engine of destruction. Virtually invincible, very few have faced this awesome creature and lived to tell the tale.</i>',\n};\nfunction update(mutate = true) {\n  const $content = document.getElementById('content')!;\n  while ($content.firstChild) $content.removeChild($content.firstChild);\n\n  const {state: s, banished, graveyard, action} = STATE.stack[STATE.index];\n  const trace = renderTrace(s, banished, graveyard, mutate);\n\n  const wrapper = createElement('div', 'wrapper');\n  wrapper.appendChild(renderState(s, banished, graveyard, handler, transform, true, `${STATE.option}${STATE.num}`));\n\n  if (action.type === 'win' || (action.type === 'play' && !s.clone().next().length)) {\n    const modal = createElement('div', 'modal', 'end', action.type === 'win' ? 'win' : 'lose');\n    const a = createElement('a');\n    a.href = `../trace?${encodeURIComponent(STATE.start.encode())}`;\n    const end = createElement('h1');\n    end.textContent = `You ${action.type === 'win' ? 'Win' : 'Lose'}`;\n    a.appendChild(end);\n    modal.appendChild(a);\n    wrapper.appendChild(modal);\n    const overlay = createElement('div', 'modal-overlay');\n    wrapper.appendChild(overlay);\n\n    // TODO: add restart\n  } else if (action.type === 'search') {\n    const modal = createElement('div', 'modal');\n    const zone = createElement('div', 'zone', 'search');\n\n    if (action.fallback) {\n      zone.appendChild(makeCard(action.fallback, () => {\n        STATE.stack[STATE.index].action = {type: 'play'};\n        action.fn('deck', -1);\n        update();\n      }, {hold: true}));\n    }\n    for (const [location, i] of action.options) {\n      const id = s[location][i] as FieldID;\n      const card = ID.decode(id);\n      zone.appendChild(makeCard(card, () => handler(location, id, i), {\n        hold: true,\n        className: transform(location, id, i, true),\n      }));\n    }\n\n    modal.appendChild(zone);\n    wrapper.appendChild(modal);\n\n    const overlay = createElement('div', 'modal-overlay');\n\n    overlay.addEventListener('click', () => {\n      if (action.num < 0) {\n        const {unique, remaining} = uniqueness();\n        console.log(unique, remaining);\n        if (unique.size === 1) {\n          STATE.stack[STATE.index].action = {type: 'play'};\n          // PRECONDITION: all targets have the same location\n          const loc = (action.targets.length ? action.targets : remaining)[0][0];\n          return action.fn(loc, ...[...action.targets.map(t => t[1]), ...remaining.map(t => t[1])]);\n        }\n        return;\n      }\n      STATE.stack[STATE.index].action = {type: 'play'};\n      if (action.num > 1 && action.targets.length) {\n        return action.fn(action.targets[0][0], action.targets[0][1]);\n      } else {\n        update();\n      }\n    }, {once: true});\n\n    wrapper.appendChild(overlay);\n  }\n\n  $content.appendChild(wrapper);\n  if (trace) {\n    $content.appendChild(trace);\n    trace.scrollTop = trace.scrollHeight;\n  }\n}\n\nfunction transform(location: Location, id: FieldID, i: number, isSearch = false) {\n  const {state, action} = STATE.stack[STATE.index];\n  const pile = (['banished', 'graveyard', 'deck'].includes(location));\n  if (action.type === 'play') {\n    if (pile) return undefined;\n    const card = ID.decode(id);\n    if (card.id === Ids.ReversalQuiz && !CAN_QUIZ(state)) return 'disabled';\n    const can = card.type === 'Monster'\n      ? (location === 'hand'\n        ? ((!state.summoned && state.monsters.length < 5) ||\n          (card.id === Ids.ThunderDragon && state.deck.length))\n        : (ID.get(id) === 3 && state.deck.length))\n      : (location === 'hand'\n        ? state.spells.length < 5 && card.can(state, location)\n        : ID.facedown(id)\n          ? card.can(state, location as 'spells')\n          : (card.id === Ids.ArchfiendsOath && !ID.get(id) && state.deck.length));\n    return can ? undefined : 'disabled';\n  } else if (action.type === 'target' || action.type === 'search') {\n    if (location === action.origin.location && i === action.origin.i) return 'selected';\n    if (!action.filter(location, id, i)) return pile ? undefined : 'disabled';\n    if (action.targets.find(([loc, j]) => loc === location && j === i)) {\n      if (!isSearch && action.type === 'search' && location === action.options[0][0]) {\n        return undefined;\n      }\n      return 'option';\n    }\n    return undefined;\n  }\n  return undefined;\n}\n\nfunction renderTrace(s: State, banished: DeckID[], graveyard: ID[], mutate = true) {\n  if (!s.trace?.length) return undefined;\n\n  const trace = createElement('div', 'trace');\n  let p = createElement('p');\n  let ul = createElement('ul');\n\n  let last = '';\n  let major = 0;\n  for (const line of s.trace) {\n    const minor = line.startsWith('  ');\n    if (!minor) {\n      if (major) {\n        p.appendChild(ul);\n        ul = createElement('ul');\n        trace.appendChild(p);\n        p = createElement('p');\n      }\n      last = line;\n      major++;\n\n      const span = createElement('span');\n      span.innerHTML = line.replace(/\"(.*?)\"/g, (_, g: string) => `\"<b>${g}</b>\"`);\n      p.appendChild(span);\n    } else {\n      const li = createElement('li');\n      li.textContent = line;\n      ul.appendChild(li);\n    }\n  }\n\n  p.appendChild(ul);\n  ul = createElement('ul');\n  trace.appendChild(p);\n\n  if (last && mutate) {\n    const activated = last.startsWith('Activate')\n      ? DATA[/\"(.*?)\"/.exec(last)![1]].id\n      : (last.startsWith('Set') && !last.endsWith('face-down'))\n        ? DATA[/then activate(?: face-down)? \"(.*?)\"/.exec(last)![1]].id\n        : undefined;\n    track(s.banished, banished, activated);\n    track(s.graveyard, graveyard, activated);\n  }\n\n  return trace;\n}\n\nfunction SPELL(fn?: (s: State) => void) {\n  return (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.remove(location, i);\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    if (card.type === 'Spell' && card.subType === 'Continuous') {\n      s.add('spells', card.id);\n    } else {\n      s.add('graveyard', card.id);\n    }\n    if (fn) fn(s);\n    s.inc();\n    update();\n  };\n}\n\nfunction ARCHFIEND(s: State, location: 'hand' | 'spells', i: number, card: Card) {\n  const play = location === 'hand' || ID.facedown(s[location][i]);\n  const prefix = play\n    ? `Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\" then pay`\n    : 'Pay';\n  const major = `${prefix} 500 LP (${s.lifepoints} -> ${s.lifepoints - 500}) to activate effect of \"${card.name}\"`;\n  if (s.known()) {\n    s.major(major);\n    s.lifepoints -= 500;\n\n    s.minor(`Declare \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n    s.draw();\n\n    s.remove(location, i);\n    s.add('spells', ID.set(card.id, 1));\n    if (play) s.inc();\n    update();\n  } else {\n    search({location, i}, loc => loc === 'deck', (_, j) => {\n      s.major(major);\n      s.lifepoints -= 500;\n\n      const top = ID.decode(s.deck[s.deck.length - 1]);\n      if (top.id === s.deck[j]) {\n        s.minor(`Declare \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n        s.draw();\n      } else {\n        s.minor(`Declare \"${j < 0 ? 'Blue-Eyes White Dragon' : ID.decode(s.deck[j]).name}\"`);\n        const reveal = ID.decode(s.deck.pop()!);\n        s.minor(`Excavate \"${reveal.name}\"`);\n        s.add('graveyard', reveal.id);\n      }\n\n      s.remove(location, i);\n      s.add('spells', ID.set(card.id, 1));\n      if (play) s.inc();\n      update();\n    }, 1, BLUE_EYES as Card);\n  }\n}\n\nfunction SANGAN_TARGET(location: Location, id: DeckID | FieldID) {\n  const card = ID.decode(id);\n  return location === 'deck' && card.type === 'Monster' && card.atk <= 1500;\n}\n\nfunction RELOAD(fn: (s: State) => void) {\n  return (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    const spells = s.spells.length;\n    let max: number;\n    if (location === 'hand') {\n      const hand = s.hand.filter((id, j) => i !== j && ID.decode(id).type !== 'Monster');\n      max = Math.min(5 - spells - 1, hand.length, s.hand.length - 2);\n    } else {\n      const hand = s.hand.filter(id => ID.decode(id).type !== 'Monster');\n      max = Math.min(5 - spells, hand.length, s.hand.length - 1);\n    }\n\n    const before = s.hand.slice();\n    target({location, i}, (loc, id) => loc === 'hand' && ID.decode(id).type !== 'Monster', (_, ...set) => {\n      // NOTE: if location === 'hand' we need to adjust the offsets of any cards we set!\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n\n      const ids = [];\n      for (const [offset, j] of set.entries()) {\n        const id = before[j];\n        ids.push(id);\n        s.add('spells', ID.toggle(id) as FieldID);\n        s.remove('hand', j - offset - (location === 'hand' && i < j ? 1 : 0));\n      }\n      if (ids.length) {\n        s.major(`Set ${Formatter.names(ids)} face-down then activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      } else {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      }\n      const len = s.hand.length;\n      fn(s);\n      s.hand = [];\n      s.draw(len);\n      s.inc();\n      update();\n    }, -max);\n  };\n}\n\n// TODO: allow playing if multi-turn is supported\nfunction CAN_QUIZ(s: State) {\n  // NOTE: we have to clone for the termination check because it mutates the final state\n  if (!s.clone().end(false)) return false;\n  // The lookahead parameter only covers the A Feather of the Phoenix, end() will still return true\n  // if Black Pendant isn't actually equipped yet (but is equippable).\n  return s.spells.some(id => ID.id(id) === Ids.BlackPendant && !ID.facedown(id));\n}\n\n// TODO: allow playing if multi-turn is supported\nfunction QUIZ(s: State, location: 'hand' | 'spells') {\n  if (!CAN_QUIZ(s)) return;\n\n  const known = s.known(true)!;\n  // NOTE: We already checked that Black Pendant is equipped\n  s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"Reversal Quiz\"`);\n  // Filter out Reversal Quiz from the messages about what gets sent to the Graveyard\n  const hand = s.hand.filter(id => ID.id(id) !== Ids.ReversalQuiz);\n  if (hand.length) s.minor(`Send ${Formatter.names(hand)} from hand to Graveyard`);\n  s.graveyard.push(...hand);\n  s.hand = [];\n\n  const ids = s.monsters.map(id => ID.id(id));\n  s.graveyard.push(...ids);\n  s.monsters = [];\n\n  for (const id of s.spells) {\n    const card = ID.decode(id);\n    if (card.id !== Ids.ReversalQuiz) {\n      continue;\n    } else if (!ID.facedown(id)) {\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.graveyard.push(card.id);\n    ids.push(card.id);\n  }\n  s.spells = [];\n  s.graveyard.sort(CMP);\n  if (ids.length) s.minor(`Send ${Formatter.names(ids)} from field to Graveyard`);\n\n  // Reversal Quiz isn't actually in the Graveyard at the point when the game is won\n  s.add('spells', Ids.ReversalQuiz);\n  // TODO: consider visually displaying the revealed card?\n  s.minor(`Call \"${ID.decode(known).type}\", reveal \"${ID.decode(s.deck[s.deck.length - 1]).name}\"`);\n  s.major(`After exchanging Life Points, opponent has ${s.lifepoints} LP and then takes 500 damage from \"Black Pendant\" being sent from the field to the Graveyard`);\n\n  STATE.stack[STATE.index].action = {type: 'win'};\n  update();\n}\n\nconst SPELLS: { [name: string]: any } = {\n  'A Feather of the Phoenix': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, loc => loc === 'hand', (_, j) => {\n      search({location, i}, loc => loc === 'graveyard', (__, k) => {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n        s.minor(`Discard \"${ID.decode(s.hand[j]).name}\"`);\n        const gid = s.remove('graveyard', k);\n        s.minor(`Return \"${ID.decode(gid).name}\" in the Graveyard to the top of the Deck`);\n        if (location === 'hand') {\n          s.discard(i < j ? [i, j] : [j, i]);\n        } else {\n          s.remove(location, i);\n          s.add('graveyard', card.id);\n          s.add('graveyard', s.remove('hand', j));\n        }\n        s.deck.push(ID.toggle(gid) as DeckID);\n        s.inc();\n        update();\n      });\n    });\n  },\n  'Archfiend\\'s Oath': SPELL(),\n  'Black Pendant': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, loc => loc === 'monsters', (_, j) => {\n      s.remove(location, i);\n      s.major(`${location === 'spells' ? `Flip face-down \"${card.name}\" and equip` : `Equip \"${card.name}\"`} to \"${ID.decode(s.monsters[j]).name}\"`);\n      s.add('spells', ID.set(card.id, j));\n      s.inc();\n      update();\n    });\n  },\n  'Card Destruction': RELOAD(s => {\n    for (const id of s.hand) {\n      s.add('graveyard', id);\n    }\n    s.minor(`Discard ${Formatter.names(s.hand)}`);\n  }),\n  'Card Shuffle': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    const reuse = location === 'spells' && !ID.facedown(s[location][i]);\n    if (reuse) {\n      s.major(`Activate effect of \"${card.name}\"`);\n    } else {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    }\n\n    s.remove(location, i);\n    s.add('spells', ID.set(card.id, 1));\n    s.minor(`Pay 300 LP (${s.lifepoints} -> ${s.lifepoints - 300})`);\n    s.lifepoints -= 300;\n    s.shuffle();\n\n    if (!reuse) s.inc();\n    update();\n  },\n  'Convulsion of Nature': SPELL(s => s.reverse()),\n  'Different Dimension Capsule': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, loc => loc === 'deck', (_, j) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('spells', card.id);\n      s.minor(`Banish ${ID.decode(s.deck[j]).name} from the deck face-down`);\n      s.add('banished', ID.toggle(ID.id(s.deck.splice(j, 1)[0])) as DeckID);\n      s.shuffle();\n      s.inc();\n      update();\n    });\n  },\n  'Giant Trunade': SPELL(s => {\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      s.add('hand', card.id);\n      if (ID.facedown(id)) continue;\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.minor(`Return ${Formatter.names(s.spells)} to hand`);\n    s.spells = [];\n  }),\n  'Graceful Charity': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n    s.remove(location, i);\n    i = s.add('spells', card.id);\n    s.draw(3);\n    update(); // FIXME bad partial state\n    // NOTE: we deliberately set the wrong index for the card so that it can't be cancelled\n    target({location: 'spells', i: -1}, loc => loc === 'hand', (_, j, k) => {\n      s.minor(`Discard \"${ID.decode(s.hand[j]).name}\" and \"${ID.decode(s.hand[k]).name}\"`);\n      s.discard([j, k]); // PRECONDITION: j < k\n      s.remove('spells', i);\n      s.add('graveyard', card.id);\n      s.inc();\n      update();\n    }, 2);\n  },\n  'Level Limit - Area B': SPELL(),\n  'Pot of Greed': SPELL(s => s.draw(2)),\n  'Premature Burial': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, (loc, id) => loc === 'graveyard' && ID.decode(id).type === 'Monster', (_, j) => {\n      s.major(`Pay 800 LP (${s.lifepoints} -> ${s.lifepoints - 800}) to activate effect of \"${card.name}\"`);\n      s.minor(`Special Summon \"${ID.decode(s.graveyard[j]).name}\" in Attack Position from Graveyard`);\n      s.lifepoints -= 800;\n      const gid = s.remove('graveyard', j);\n      const zone = s.summon(gid, true);\n      s.remove(location, i);\n      s.add('spells', ID.set(card.id, zone));\n      s.inc(zone);\n      update();\n    });\n  },\n  'Heavy Storm': SPELL(s => {\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      s.add('graveyard', card.id);\n      if (ID.facedown(id)) continue;\n      if (card.id === Ids.ConvulsionOfNature) {\n        s.reverse(true);\n      } else if (card.id === Ids.BlackPendant) {\n        s.mset(ID.get(id));\n      } else if (card.id === Ids.PrematureBurial) {\n        const removed = s.mremove(ID.get(id));\n        s.add('graveyard', removed.id);\n        s.minor(`Sending \"${ID.decode(removed.id).name}\" to the Graveyard after its equipped \"${ID.decode(id).name}\" was destroyed`);\n      } else if (card.id === Ids.DifferentDimensionCapsule) {\n        s.banish();\n      }\n    }\n    s.minor(`Send ${Formatter.names(s.spells)} to Graveyard`);\n    s.spells = [];\n  }),\n  'Reload': RELOAD(s => {\n    s.deck.push(...s.hand);\n    s.minor(`Return ${Formatter.names(s.hand)} to Deck`);\n    s.shuffle();\n  }),\n  'Reversal Quiz': (s: State, location: 'hand' | 'spells', i: number, self: Card) => {\n    let sangan = false;\n    s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${self.name}\"`);\n    if (s.hand.length) {\n      s.minor(`Send ${Formatter.names(s.hand)} from hand to Graveyard`);\n    }\n    if (s.monsters.length || s.spells.length) {\n      s.minor(`Send ${Formatter.names([...s.monsters, ...s.spells])} from field to Graveyard`);\n    }\n\n    s.graveyard.push(...s.hand);\n    s.hand = [];\n    for (const id of s.monsters) {\n      const card = ID.decode(id);\n      if (card.id === Ids.Sangan) sangan = true;\n      s.graveyard.push(card.id);\n    }\n    s.monsters = [];\n    for (const id of s.spells) {\n      const card = ID.decode(id);\n      if (!ID.facedown(id)) {\n        if (card.id === Ids.ConvulsionOfNature) {\n          s.reverse(true);\n        } else if (card.id === Ids.DifferentDimensionCapsule) {\n          s.banish();\n        }\n      }\n      s.graveyard.push(card.id);\n    }\n    s.spells = [];\n    s.graveyard.sort(CMP);\n\n    const reveal = s.deck[s.deck.length - 1];\n    if (!ID.known(reveal)) s.deck[s.deck.length - 1] = ID.toggle(reveal) as DeckID;\n    // BUG: we are deliberately peeking here to ensure we call it wrong!\n    const card = ID.decode(reveal);\n    s.minor(`Call \"${card.type === 'Trap' ? 'Monster' : 'Trap'}\", reveal \"${card.name}\"`);\n    if (!sangan) return update();\n\n    search({location, i}, SANGAN_TARGET, (_, j) => {\n      if (j < 0) {\n        s.minor('Fail to find \"Sangan\" target in Deck');\n      } else {\n        const id = ID.id(s.deck.splice(j, 1)[0]);\n        s.minor(`Add \"${ID.decode(id).name}\" from Deck to hand after \"Sangan\" was sent to the Graveyard`);\n        s.add('hand', id);\n      }\n      s.shuffle();\n      update();\n    });\n  },\n  // TODO: handle flipping Royal Decree in multi-turn scenarios\n  'Royal Decree': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    s.remove(location, i);\n    if (location === 'hand') {\n      s.major(`Set \"${card.name}\" face-down`);\n      s.add('spells', ID.toggle(card.id) as FieldID);\n    } // else {\n    //   s.major(`Activate face-down' \"${card.name}\"`);\n    //   s.add('spells', card.id);\n    // }\n    update();\n  },\n  'Spell Reproduction': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    target({location, i}, (loc, id) => loc === 'hand' && ID.decode(id).type === 'Spell', (_, j, k) => {\n      search({location, i}, (loc, id) => loc === 'graveyard' && ID.decode(id).type === 'Spell', (__, g) => {\n        s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n        s.minor(`Discard \"${ID.decode(s.hand[j]).name}\" and \"${ID.decode(s.hand[k]).name}\"`);\n        const gid = s.remove('graveyard', g);\n        if (location === 'hand') {\n          s.discard([i, j, k].sort(CMP));\n        } else {\n          s.remove(location, i);\n          s.add('graveyard', card.id);\n          s.discard([j, k]); // PRECONDITION: j < k\n        }\n        s.minor(`Add \"${ID.decode(gid).name}\" in the Graveyard to hand`);\n        s.add('hand', gid);\n        s.inc();\n        update();\n      });\n    }, 2);\n  },\n  'Spellbook Organization': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i: -1}, (loc, _, j) => loc === 'deck' && j >= s.deck.length - 3, (_, j, k, l) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n      s.minor(`Reveal ${Formatter.names(s.deck.slice(s.deck.length - 3).reverse())}`);\n\n      const ordered = [s.deck[j], s.deck[k], s.deck[l]];\n      s.minor(`Return ${Formatter.names(ordered)} to the Deck`);\n      for (let m = 0; m < ordered.length; m++) {\n        s.deck[s.deck.length - 1 - m] =\n          ID.facedown(ordered[m]) ? ordered[m] : ID.toggle(ordered[m]) as DeckID;\n      }\n\n      s.inc();\n      update();\n    }, -3);\n  },\n  'Toon Table of Contents': (s: State, location: 'hand' | 'spells', i: number, card: Card) => {\n    search({location, i}, (loc, id) => loc === 'deck' && ID.decode(id).name.startsWith('Toon'), (_, j) => {\n      s.major(`Activate${location === 'spells' ? ' face-down' : ''} \"${card.name}\"`);\n      s.remove(location, i);\n      s.add('graveyard', card.id);\n      if (j < 0) {\n        s.minor('Fail to find \"Toon\" card in Deck');\n      } else {\n        s.minor(`Add \"${ID.decode(s.deck[j]).name}\" from Deck to hand`);\n        s.add('hand', ID.id(s.deck.splice(j, 1)[0]));\n      }\n      s.shuffle();\n      s.inc();\n      update();\n    });\n  },\n  'Toon World': SPELL(s => {\n    s.minor(`Pay 1000 LP (${s.lifepoints} -> ${s.lifepoints - 1000})`);\n    s.lifepoints -= 1000;\n  }),\n  'Upstart Goblin': SPELL(s => s.draw()),\n};\n\nfunction handler(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  console.log(action, location, id, i); // Formatter\n  switch (action.type) {\n  case 'play': return onPlay(location, id, i);\n  case 'target': return onTarget(location, id, i);\n  case 'search': return onSearch(location, id, i);\n  }\n}\n\nfunction onPlay(location: Location, id: FieldID, i: number) {\n  const state = STATE.stack[STATE.index].state;\n\n  const card = ID.decode(id);\n  switch (location) {\n  case 'monsters': {\n    if (card.id === Ids.RoyalMagicalLibrary) {\n      if (ID.facedown(id) || ID.get(id) !== 3 || !state.deck.length) return;\n      state.major(`Remove 3 Spell Counters from \"${card.name}\"`);\n      state.mset(i);\n      state.draw();\n      return update();\n    }\n    return;\n  }\n  case 'spells': {\n    if (card.type === 'Monster' || !card.can(state, location)) return;\n    if (card.id === Ids.ReversalQuiz) {\n      QUIZ(state, location);\n    } else if (ID.facedown(id)) {\n      const spell = SPELLS[card.name];\n      if (spell) spell(state, location, i, card);\n    } else if (card.id === Ids.ArchfiendsOath && !ID.get(id)) {\n      ARCHFIEND(state, location, i, card);\n    } else if (card.id === Ids.CardShuffle && !ID.get(id)) {\n      SPELLS[card.name]!(state, location, i, card);\n    }\n    return;\n  }\n  case 'hand': {\n    if (card.id === Ids.ReversalQuiz) {\n      QUIZ(state, location);\n    } else if (card.id === Ids.ThunderDragon) {\n      const find = (s: State) => {\n        search({location, i}, (loc, sid) => loc === 'deck' && ID.id(sid) === Ids.ThunderDragon, (_, ...targets) => {\n          s.major(`Discard \"${card.name}\"`);\n          s.remove('hand', i);\n          s.add('graveyard', card.id);\n          if (targets.length === 2) {\n            s.minor(`Add 2 \"${card.name}\" from Deck to hand`);\n            // PRECONDITION: targets[0] < targets[1]\n            s.add('hand', ID.id(s.deck.splice(targets[0], 1)[0]));\n            s.add('hand', ID.id(s.deck.splice(targets[1] - 1, 1)[0]));\n          } else if (targets[0] >= 0) {\n            s.minor(`Add \"${card.name}\" from Deck to hand`);\n            s.add('hand', ID.id(s.deck.splice(targets[0], 1)[0]));\n          } else {\n            s.minor(`Fail to find \"${card.name}\" in Deck`);\n          }\n          s.shuffle();\n          update();\n        }, 2);\n      };\n\n      if (state.monsters.length && state.monsters.length < 5 && !state.summoned) {\n        target({location, i}, loc => loc === 'deck' || loc === 'monsters', (loc, j) => {\n          if (loc === 'deck') {\n            find(state);\n          } else {\n            const t = ID.decode(state.monsters[j]);\n            state.major(`Tribute \"${t.name}\" to Summon \"${self.name}\"`);\n            state.tribute(j, i);\n            if (t.id === Ids.Sangan) {\n              search({location: 'graveyard', i: -1}, SANGAN_TARGET, (_, k) => {\n                if (k < 0) {\n                  state.minor('Fail to find \"Sangan\" target in Deck');\n                } else {\n                  const did = ID.id(state.deck.splice(k, 1)[0]);\n                  state.minor(`Add \"${ID.decode(did).name}\" from Deck to hand after \"Sangan\" was sent to the Graveyard`);\n                  state.add('hand', did);\n                }\n                state.shuffle();\n                update();\n              });\n            } else {\n              update();\n            }\n          }\n        });\n      } else {\n        find(state);\n      }\n    } else if (card.type === 'Monster') {\n      if (state.monsters.length >= 5 || state.summoned) return;\n      state.remove(location, i);\n      state.major(`Summon \"${card.name}\" in Attack Position`);\n      state.summon(card.id);\n      return update();\n    } else {\n      if (state.spells.length >= 5 || !card.can(state, location)) return;\n      const spell = SPELLS[card.name];\n      if (spell) spell(state, location, i, card);\n    }\n  }\n  }\n}\n\nfunction target(\n  origin: {location: Location; i: number},\n  filter: (location: Location, id: DeckID | FieldID) => boolean,\n  fn: (location: Location, ...j: number[]) => void,\n  num = 1\n) {\n  if (num === 0) return fn(origin.location);\n  const state = STATE.stack[STATE.index].state;\n\n  const targets: ['hand' | 'spells' | 'monsters' | 'deck', number][] = [];\n  for (const location of ['hand', 'spells', 'monsters'] as const) {\n    for (const [i, id] of state[location].entries()) {\n      if (location === origin.location && i === origin.i) continue;\n      if (filter(location, id)) targets.push([location, i]);\n    }\n  }\n  if (state.deck.length && filter('deck', state.deck[state.deck.length - 1] as FieldID)) {\n    targets.push(['deck', state.deck.length - 1]);\n  }\n\n  if (num > 0 && targets.length === num) {\n    // PRECONDITION: new Set(targets.map(t => t[0])).size === 1\n    return fn(targets[0][0], ...targets.map(t => t[1]).sort(CMP));\n  } else {\n    STATE.stack[STATE.index].action = {\n      type: 'target',\n      origin,\n      filter,\n      fn,\n      num,\n      targets: [],\n    };\n    update();\n  }\n}\n\nfunction onTarget(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  if (action.type !== 'target') throw new Error(`Invalid action type ${action.type}`);\n\n  if (location === action.origin.location && i === action.origin.i) {\n    STATE.stack[STATE.index].action = {type: 'play'};\n    if (action.num < 0) {\n      if (action.targets.length) {\n        // PRECONDITION: all targets have the same location\n        return action.fn(action.targets[0][0], ...action.targets.map(t => t[1]).sort(CMP));\n      } else {\n        return action.fn(location);\n      }\n    } else {\n      update();\n    }\n  } else if (action.filter(location, id, i)) {\n    const remove = action.targets.findIndex(([loc, j]) => loc === location && j === i);\n    if (remove >= 0) {\n      action.targets.splice(remove, 1);\n    } else {\n      action.targets.push([location, i]);\n    }\n\n    if (action.targets.length === Math.abs(action.num)) {\n      STATE.stack[STATE.index].action = {type: 'play'};\n      // PRECONDITION: all targets have the same location\n      return action.fn(action.targets[0][0], ...action.targets.map(t => t[1]).sort(CMP));\n    } else {\n      update();\n    }\n  }\n}\n\nfunction search(\n  origin: {location: Location; i: number},\n  filter: (location: Location, id: DeckID | FieldID, i: number) => boolean,\n  fn: (location: Location, ...j: number[]) => void,\n  num = 1,\n  fallback?: Card,\n) {\n  const state = STATE.stack[STATE.index].state;\n\n  const targets: ['graveyard' | 'deck', number][] = [];\n  const ids = new Set<ID>();\n  for (const location of ['graveyard', 'deck'] as const) {\n    for (const [i, did] of state[location].entries()) {\n      const id = ID.id(did);\n      if (location === origin.location && i === origin.i || ids.has(id)) continue;\n      if (filter(location, id, i)) {\n        if (num === 1) ids.add(id);\n        targets.push([location, i]);\n      }\n    }\n  }\n\n  if (targets.length === 0) {\n    fn('hand', -1); // NOTE: we don't actually have a valid location...\n  } else if (targets.length === 1) {\n    return fn(targets[0][0], targets[0][1]);\n  } else {\n    STATE.stack[STATE.index].action = {\n      type: 'search',\n      origin,\n      filter,\n      fn,\n      num,\n      targets: [],\n      options: num < 0 ? targets.reverse() : targets.sort((a, b) =>\n        ID.decode(state[a[0]][a[1]]).name.localeCompare(ID.decode(state[b[0]][b[1]]).name)),\n      fallback,\n    };\n    update();\n  }\n}\n\nfunction onSearch(location: Location, id: FieldID, i: number) {\n  const action = STATE.stack[STATE.index].action;\n  if (action.type !== 'search') throw new Error(`Invalid action type ${action.type}`);\n\n  if (location === action.origin.location && i === action.origin.i) {\n    STATE.stack[STATE.index].action = {type: 'play'};\n    if (action.num > 1 && action.targets.length) {\n      return action.fn(action.targets[0][0], action.targets[0][1]);\n    } else {\n      update();\n    }\n  } else if (action.filter(location, id, i)) {\n    const remove = action.targets.findIndex(([loc, j]) => loc === location && j === i);\n    if (remove >= 0) {\n      action.targets.splice(remove, 1);\n    } else {\n      action.targets.push([location, i]);\n    }\n\n    if (action.targets.length === Math.abs(action.num)) {\n      STATE.stack[STATE.index].action = {type: 'play'};\n      // PRECONDITION: all targets have the same location\n      const targets = action.targets.map(t => t[1]);\n      return action.fn(action.targets[0][0], ...(action.num > 0 ? targets.sort(CMP) : targets));\n    } else if (action.num < 0) {\n      const {unique, remaining} = uniqueness();\n      if (unique.size === 1) {\n        STATE.stack[STATE.index].action = {type: 'play'};\n        // PRECONDITION: all targets have the same location\n        const loc = (action.targets.length ? action.targets : remaining)[0][0];\n        return action.fn(loc, ...[...action.targets.map(t => t[1]), ...remaining.map(t => t[1])]);\n      } else {\n        update();\n      }\n    } else {\n      update();\n    }\n  }\n}\n\nfunction uniqueness() {\n  const {state, action} = STATE.stack[STATE.index];\n  if (action.type !== 'search') throw new Error(`Bad action type: ${action.type}`);\n  const remaining = action.options.slice();\n  for (const [loc, j] of action.targets) {\n    remaining.splice(remaining.findIndex(([l, k]) => l === loc && k === j), 1);\n  }\n  const unique = new Set(remaining.map(([loc, j]) => ID.id(state[loc][j])));\n  return {remaining, unique};\n}\n\nfunction initialize(option: Option, num: number) {\n  console.log('Seed:', num);\n\n  const state = State.create(State.decklist(option), new Random(Random.seed(num)), true);\n\n  STATE = {\n    option,\n    num,\n    start: state.clone(),\n    stack: [{\n      state,\n      banished: [],\n      graveyard: [],\n      action: {type: 'play'},\n    } as Context],\n    index: 0,\n  };\n\n  const undo = () => {\n    // if (STATE.index) {\n    //   STATE.index--;\n    //   update(false);\n    // }\n  };\n\n  const redo = () => {\n    // if (STATE.index < STATE.stack.length - 1) {\n    //   STATE.index++;\n    //   update(false);\n    // }\n  };\n\n  const cancel = () => {\n    const action = STATE.stack[STATE.index].action;\n    if (action.type === 'target' || action.type === 'search') {\n      if (action.origin.i >= 0) {\n        STATE.stack[STATE.index].action = {type: 'play'};\n      } else {\n        (STATE.stack[STATE.index].action as ActionState).targets = [];\n      }\n      update();\n    }\n  };\n\n  const CLICKABLE = ['modal', 'modal-overlay', 'card'];\n  document.addEventListener('click', e => {\n    if (e.target instanceof Element) {\n      for (let p: Element | null = e.target; p; p = p.parentElement) {\n        if (CLICKABLE.some(c => p!.classList.contains(c))) {\n          return true;\n        }\n      }\n    }\n    cancel();\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  });\n  document.addEventListener('swiped-left', undo);\n  document.addEventListener('swiped-right', redo);\n  document.addEventListener('keydown', e => {\n    const key = e.which || e.keyCode;\n    switch (key) {\n    case 27:\n      cancel();\n      break;\n    case 37:\n      undo();\n      break;\n    case 39:\n      redo();\n      break;\n    default:\n      return true;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  });\n\n  /* eslint-disable @typescript-eslint/no-floating-promises */\n  const pool = workerpool.pool(new URL('./worker.ts', import.meta.url).pathname);\n  pool.exec('search', [STATE.start.encode(), 42, 1e6, false, 0.5]).then(r => {\n    console.log('Path:', r);\n  }).catch(e => {\n    console.error(e);\n  }).then(() => {\n    pool.terminate();\n  });\n\n  update();\n}\n\nfunction start() {\n  const arg = (window.location.hash || window.location.search).slice(1);\n  if (OPTIONS.includes(arg[0] as Option)) {\n    const n = arg.slice(1);\n    if (n && !isNaN(+n)) return initialize(arg[0] as Option, +n);\n  }\n  const num = arg && !isNaN(+arg) ? +arg : ~~(Math.random() * (2 ** 31 - 1));\n\n  const $content = document.getElementById('content')!;\n  while ($content.firstChild) $content.removeChild($content.firstChild);\n  const zone = createElement('div', 'zone', 'start');\n  for (const id of OPTIONS) {\n    const card = ID.decode(Formatter.unhuman(id));\n    zone.appendChild(makeCard(card, () => {\n      initialize(id, num);\n    }, {hold: true}));\n  }\n  $content.appendChild(zone);\n}\n\nstart();\n","/* ! Modified from John Doherty's MIT-licensed https://github.com/john-doherty/swiped-events */\n(() => {\n  'use strict';\n\n  const THRESHOLD = 100;\n  const TIMEOUT = 500;\n\n  let downX: number | null = null;\n  let downY: number | null = null;\n  let diffX = 0;\n  let diffY = 0;\n  let timeDown: number | null = null;\n  let startElement: EventTarget | null = null;\n\n  if (typeof window.CustomEvent !== 'function') {\n    // @ts-ignore\n    window.CustomEvent = (event: string, params: any) => {\n      params = params || {bubbles: false, cancelable: false, detail: undefined};\n      const e = document.createEvent('CustomEvent');\n      e.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return e;\n    };\n\n    // @ts-ignore\n    window.CustomEvent.prototype = window.Event.prototype;\n  }\n\n  function handleTouchEnd(e: TouchEvent) {\n    if (startElement !== e.target) return;\n\n    const timeDiff = Date.now() - timeDown!;\n    let eventType = '';\n\n    if (Math.abs(diffX) > Math.abs(diffY)) {\n      if (Math.abs(diffX) > THRESHOLD && timeDiff < TIMEOUT) {\n        if (diffX > 0) {\n          eventType = 'swiped-left';\n        } else {\n          eventType = 'swiped-right';\n        }\n      }\n    } else {\n      if (Math.abs(diffY) > THRESHOLD && timeDiff < TIMEOUT) {\n        if (diffY > 0) {\n          eventType = 'swiped-up';\n        } else {\n          eventType = 'swiped-down';\n        }\n      }\n    }\n\n    if (eventType) {\n      startElement!.dispatchEvent(new CustomEvent(eventType, {bubbles: true, cancelable: true}));\n    }\n\n    downX = null;\n    downY = null;\n    timeDown = null;\n  }\n\n  function handleTouchStart(e: TouchEvent) {\n    startElement = e.target;\n\n    timeDown = Date.now();\n    downX = e.touches[0].clientX;\n    downY = e.touches[0].clientY;\n    diffX = 0;\n    diffY = 0;\n  }\n\n  function handleTouchMove(e: TouchEvent) {\n    if (!downX || !downY) return;\n    diffX = downX - e.touches[0].clientX;\n    diffY = downY - e.touches[0].clientY;\n  }\n\n  document.addEventListener('touchstart', handleTouchStart, false);\n  document.addEventListener('touchmove', handleTouchMove, false);\n  document.addEventListener('touchend', handleTouchEnd, false);\n})();\n","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","module.exports = require('./helpers/bundle-url').getBundleURL('gcU1a') + \"../\" + require('./helpers/bundle-manifest').resolve(\"4bfU0\");"],"names":["$8b4d1930797b255e$export$6503ec6e8aabbaf","$8b4d1930797b255e$export$f7ad0328861e2f03","$8b4d1930797b255e$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","root","factory","self","this","Promise","require","WorkerHandler","environment","DEBUG_PORT_ALLOCATOR","Pool","script","options","workers","tasks","forkArgs","forkOpts","debugPortStart","nodeWorker","workerType","maxQueueSize","Infinity","maxWorkers","isNumber","isInteger","TypeError","validateMaxWorkers","Math","max","cpus","minWorkers","validateMinWorkers","_ensureMinWorkers","_boundNext","_next","bind","ensureWorkerThreads","value","round","prototype","exec","method","params","Array","isArray","resolver","defer","task","timeout","push","originalTimeout","promise","delay","indexOf","call","String","proxy","arguments","pool","then","methods","forEach","slice","worker","_getWorker","me","shift","pending","terminated","_removeWorker","busy","_createWorkerHandler","releasePort","debugPort","_removeWorkerFromList","resolve","reject","terminate","err","index","splice","force","removeWorker","promises","termPromise","terminateAndNotify","all","stats","totalWorkers","busyWorkers","filter","idleWorkers","pendingTasks","activeTasks","nextAvailableStartingAt","module","exports","handler","parent","SyntaxError","_onSuccess","_onFail","rejected","_process","onSuccess","onFail","s","_then","f","_resolve","result","fn","_reject","error","cancel","CancellationError","timer","setTimeout","TimeoutError","always","clearTimeout","callback","res","message","stack","remaining","results","p","constructor","name","requireFoolWebpack","TERMINATE_METHOD_ID","WorkerThreads","tryRequireWorkerThreads","ensureWebWorker","Worker","_typeof","code","setupBrowserWorker","isBrowserWorker","on","event","addEventListener","data","send","postMessage","setupWorkerThreadWorker","stdout","stderr","isWorkerThread","kill","disconnect","setupProcessWorker","child_process","fork","isChildProcess","resolveForkOptions","opts","processExecArgv","process","execArgv","join","inspectorActive","debugBrk","arg","assign","concat","_options","onError","processing","undefined","create","platform","Blob","window","URL","createObjectURL","blob","type","__dirname","getDefaultWorker","setupWorker","ready","requestQueue","response","_step","_iterator","_createForOfIteratorHelper","n","done","request","e","dispatchQueuedRequests","isEvent","payload","terminating","obj","temp","props","objectToError","exitCode","signalCode","spawnargs","spawnfile","terminationHandler","lastId","cleanup","removeAllListeners","killed","cleanExitTimeout","once","DebugPortAllocator","ports","starting","port","isNode","nodeProcess","versions","node","worker_threads","tryRequireFoolWebpack","isMainThread","connected","Window","navigator","hardwareConcurrency","eval","exit","parentPort","convertError","getOwnPropertyNames","reduce","product","defineProperty","enumerable","isPromise","run","args","Function","apply","currentRequestId","hasOwnProperty","emit","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","add","define","amd","$98afc9c033b94801$var$cachedSetTimeout","$98afc9c033b94801$var$cachedClearTimeout","$98afc9c033b94801$var$process","$98afc9c033b94801$var$defaultSetTimout","$98afc9c033b94801$var$defaultClearTimeout","$98afc9c033b94801$var$runTimeout","fun","e1","$98afc9c033b94801$var$currentQueue","$98afc9c033b94801$var$queue","$98afc9c033b94801$var$draining","$98afc9c033b94801$var$queueIndex","$98afc9c033b94801$var$cleanUpNextTick","$98afc9c033b94801$var$drainQueue","len","marker","$98afc9c033b94801$var$runClearTimeout","$98afc9c033b94801$var$Item","array","$98afc9c033b94801$var$noop","nextTick","title","browser","env","argv","version","addListener","off","removeListener","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","$365bb179207d3425$var$STATE","downX","downY","diffX","diffY","timeDown","startElement","CustomEvent","bubbles","cancelable","detail","document","createEvent","initCustomEvent","Event","target","Date","now","touches","clientX","clientY","timeDiff","eventType","abs","dispatchEvent","$365bb179207d3425$var$BLUE_EYES","attribute","level","atk","def","text","$365bb179207d3425$var$update","mutate","$content","getElementById","firstChild","removeChild","state","banished","graveyard","action","trace","$365bb179207d3425$var$renderTrace","wrapper","$iPHaw","createElement","appendChild","renderState","$365bb179207d3425$var$handler","$365bb179207d3425$var$transform","option","num","clone","next","modal","a","href","encodeURIComponent","start","encode","end","textContent","overlay","zone","fallback","makeCard","hold","location","card","$l7khe","ID","decode","className","unique","$365bb179207d3425$var$uniqueness","console","log","size","loc","targets","map","t","scrollTop","scrollHeight","isSearch","pile","includes","Ids","ReversalQuiz","$365bb179207d3425$var$CAN_QUIZ","summoned","monsters","ThunderDragon","deck","get","spells","can","facedown","ArchfiendsOath","origin","find","j","ul","last","major","line","startsWith","li","span","innerHTML","replace","_","g","activated","DATA","endsWith","track","$365bb179207d3425$var$SPELL","remove","subType","inc","$365bb179207d3425$var$ARCHFIEND","play","lifepoints","known","minor","draw","set","$365bb179207d3425$var$search","reveal","pop","$365bb179207d3425$var$SANGAN_TARGET","$365bb179207d3425$var$RELOAD","hand","min","before","$365bb179207d3425$var$target","ids","offset","entries","toggle","Formatter","names","some","BlackPendant","$365bb179207d3425$var$QUIZ","ConvulsionOfNature","reverse","DifferentDimensionCapsule","banish","sort","CMP","$365bb179207d3425$var$SPELLS","__","k","gid","discard","reuse","shuffle","summon","mset","PrematureBurial","removed","mremove","Reload","sangan","Sangan","id1","l","ordered","m","$365bb179207d3425$var$onPlay","$365bb179207d3425$var$onTarget","$365bb179207d3425$var$onSearch","RoyalMagicalLibrary","spell","CardShuffle","sid","tribute","did","findIndex","Set","has","b","localeCompare","$365bb179207d3425$var$initialize","State","decklist","Random","seed","undo","redo","CLICKABLE","Element","parentElement","c","classList","contains","preventDefault","stopPropagation","which","keyCode","$ahpAG","$13b0d6eb21343cd3$exports","pathname","r","catch","$365bb179207d3425$var$start","hash","search","OPTIONS","isNaN","random","unhuman","$f29cd6c67ea13581$export$bdfd709ae4826697","$f29cd6c67ea13581$var$bundleURL","$f29cd6c67ea13581$var$getBaseURL","url","matches","match","$f29cd6c67ea13581$var$getBundleURL","getBundleURL"],"version":3,"file":"index.3c279550.js.map"}